Client Version: v1.34.1
Kustomize Version: v5.7.1
[live-eval] Installing common CRDs (Prometheus, Traefik)
The CustomResourceDefinition "alertmanagers.monitoring.coreos.com" is invalid: metadata.annotations: Too long: may not be more than 262144 bytes
The CustomResourceDefinition "prometheuses.monitoring.coreos.com" is invalid: metadata.annotations: Too long: may not be more than 262144 bytes
customresourcedefinition.apiextensions.k8s.io/servicemonitors.monitoring.coreos.com unchanged
error: unable to read URL "https://raw.githubusercontent.com/traefik/traefik-helm-chart/master/traefik/crds/ingressroutes.yaml", server reported 404 Not Found, status code=404
[live-eval] Seeding RBAC and default NetworkPolicies
serviceaccount/autofix-placeholder unchanged
clusterrole.rbac.authorization.k8s.io/autofix:node-reader unchanged
clusterrolebinding.rbac.authorization.k8s.io/autofix:node-reader unchanged
role.rbac.authorization.k8s.io/autofix:network-policy unchanged
rolebinding.rbac.authorization.k8s.io/autofix:network-policy unchanged
networkpolicy.networking.k8s.io/autofix-default-deny unchanged
networkpolicy.networking.k8s.io/autofix-kube-system-egress unchanged
[live-eval] Detect -> filter -> Propose (rules) -> Verify (server dry-run)
Detected 15852 violation(s). Report written to /Users/brianmendonca/Downloads/untitled folder/k8s-auto-fix/data/detections_live.json
Filtered detections: kept 14376 / 15852
╭───────────────────── Traceback (most recent call last) ──────────────────────╮
│ /Users/brianmendonca/Downloads/untitled                                      │
│ folder/k8s-auto-fix/src/proposer/cli.py:163 in propose                       │
│                                                                              │
│    160 │   │   │   if not isinstance(record, dict):                          │
│    161 │   │   │   │   raise typer.BadParameter("Detection entries must be J │
│    162 │   │   │   patches.append(                                           │
│ ❱  163 │   │   │   │   _generate_patch_record(                               │
│    164 │   │   │   │   │   record,                                           │
│    165 │   │   │   │   │   config_data=config_data,                          │
│    166 │   │   │   │   │   base_dir=base_dir,                                │
│                                                                              │
│ ╭───────────────────────────────── locals ─────────────────────────────────╮ │
│ │        base_dir = PosixPath('/Users/brianmendonca/Downloads/untitled     │ │
│ │                   folder/k8s-auto-fix/data')                             │ │
│ │          config = PosixPath('/Users/brianmendonca/Downloads/untitled     │ │
│ │                   folder/k8s-auto-fix/configs/run_rules.yaml')           │ │
│ │     config_data = {                                                      │ │
│ │                   │   'grok': {                                          │ │
│ │                   │   │   'api_key_env': 'XAI_API_KEY',                  │ │
│ │                   │   │   'auth_header': 'Authorization',                │ │
│ │                   │   │   'auth_scheme': 'Bearer',                       │ │
│ │                   │   │   'endpoint':                                    │ │
│ │                   'https://api.x.ai/v1/chat/completions',                │ │
│ │                   │   │   'model': 'grok-4-fast-reasoning'               │ │
│ │                   │   },                                                 │ │
│ │                   │   'max_attempts': 3,                                 │ │
│ │                   │   'proposer': {                                      │ │
│ │                   │   │   'mode': 'rules',                               │ │
│ │                   │   │   'retries': 2,                                  │ │
│ │                   │   │   'timeout_seconds': 60                          │ │
│ │                   │   },                                                 │ │
│ │                   │   'rules': {'enabled': True},                        │ │
│ │                   │   'seed': 1337,                                      │ │
│ │                   │   'vendor': {                                        │ │
│ │                   │   │   'api_key_env': 'OPENAI_API_KEY',               │ │
│ │                   │   │   'endpoint':                                    │ │
│ │                   'https://api.openai.com/v1/chat/completions',          │ │
│ │                   │   │   'model': 'gpt-4o-mini'                         │ │
│ │                   │   },                                                 │ │
│ │                   │   'vllm': {                                          │ │
│ │                   │   │   'api_key_env': 'RUNPOD_API_KEY',               │ │
│ │                   │   │   'endpoint':                                    │ │
│ │                   'https://<RUNPOD_ENDPOINT>/v1/chat/completions',       │ │
│ │                   │   │   'model': 'meta-llama/Meta-Llama-3-8B-Instruct' │ │
│ │                   │   }                                                  │ │
│ │                   }                                                      │ │
│ │      detections = PosixPath('/Users/brianmendonca/Downloads/untitled     │ │
│ │                   folder/k8s-auto-fix/data/detections_live_filtered.jso… │ │
│ │ detections_data = [                                                      │ │
│ │                   │   {                                                  │ │
│ │                   │   │   'id': '001',                                   │ │
│ │                   │   │   'manifest_path': 'data/manifests/001.yaml',    │ │
│ │                   │   │   'manifest_yaml': 'apiVersion: v1\nkind:        │ │
│ │                   Pod\nmetadata:\n  name: nginx-latest\n  namespace:     │ │
│ │                   default\nspe'+92,                                      │ │
│ │                   │   │   'policy_id': 'cap-sys-admin',                  │ │
│ │                   │   │   'violation_text': 'container capabilities must │ │
│ │                   drop SYS_ADMIN'                                        │ │
│ │                   │   },                                                 │ │
│ │                   │   {                                                  │ │
│ │                   │   │   'id': '002',                                   │ │
│ │                   │   │   'manifest_path': 'data/manifests/001.yaml',    │ │
│ │                   │   │   'manifest_yaml': 'apiVersion: v1\nkind:        │ │
│ │                   Pod\nmetadata:\n  name: nginx-latest\n  namespace:     │ │
│ │                   default\nspe'+92,                                      │ │
│ │                   │   │   'policy_id': 'latest-tag',                     │ │
│ │                   │   │   'violation_text': 'The container "nginx" is    │ │
│ │                   using an invalid container image, "nginx:latest".      │ │
│ │                   Pleas'+104                                             │ │
│ │                   │   },                                                 │ │
│ │                   │   {                                                  │ │
│ │                   │   │   'id': '003',                                   │ │
│ │                   │   │   'manifest_path': 'data/manifests/001.yaml',    │ │
│ │                   │   │   'manifest_yaml': 'apiVersion: v1\nkind:        │ │
│ │                   Pod\nmetadata:\n  name: nginx-latest\n  namespace:     │ │
│ │                   default\nspe'+92,                                      │ │
│ │                   │   │   'policy_id': 'no-read-only-root-fs',           │ │
│ │                   │   │   'violation_text': 'container "nginx" does not  │ │
│ │                   have a read-only root file system'                     │ │
│ │                   │   },                                                 │ │
│ │                   │   {                                                  │ │
│ │                   │   │   'id': '004',                                   │ │
│ │                   │   │   'manifest_path': 'data/manifests/001.yaml',    │ │
│ │                   │   │   'manifest_yaml': 'apiVersion: v1\nkind:        │ │
│ │                   Pod\nmetadata:\n  name: nginx-latest\n  namespace:     │ │
│ │                   default\nspe'+92,                                      │ │
│ │                   │   │   'policy_id': 'run-as-non-root',                │ │
│ │                   │   │   'violation_text': 'container "nginx" is not    │ │
│ │                   set to runAsNonRoot'                                   │ │
│ │                   │   },                                                 │ │
│ │                   │   {                                                  │ │
│ │                   │   │   'id': '005',                                   │ │
│ │                   │   │   'manifest_path': 'data/manifests/001.yaml',    │ │
│ │                   │   │   'manifest_yaml': 'apiVersion: v1\nkind:        │ │
│ │                   Pod\nmetadata:\n  name: nginx-latest\n  namespace:     │ │
│ │                   default\nspe'+92,                                      │ │
│ │                   │   │   'policy_id': 'unset-cpu-requirements',         │ │
│ │                   │   │   'violation_text': 'container "nginx" has cpu   │ │
│ │                   request 0'                                             │ │
│ │                   │   },                                                 │ │
│ │                   │   {                                                  │ │
│ │                   │   │   'id': '006',                                   │ │
│ │                   │   │   'manifest_path': 'data/manifests/001.yaml',    │ │
│ │                   │   │   'manifest_yaml': 'apiVersion: v1\nkind:        │ │
│ │                   Pod\nmetadata:\n  name: nginx-latest\n  namespace:     │ │
│ │                   default\nspe'+92,                                      │ │
│ │                   │   │   'policy_id': 'unset-memory-requirements',      │ │
│ │                   │   │   'violation_text': 'container "nginx" has       │ │
│ │                   memory limit 0'                                        │ │
│ │                   │   },                                                 │ │
│ │                   │   {                                                  │ │
│ │                   │   │   'id': '007',                                   │ │
│ │                   │   │   'manifest_path': 'data/manifests/002.yaml',    │ │
│ │                   │   │   'manifest_yaml': 'apiVersion: v1\nkind:        │ │
│ │                   Pod\nmetadata:\n  name: privileged-pod\n  namespace:   │ │
│ │                   default\ns'+142,                                       │ │
│ │                   │   │   'policy_id': 'cap-sys-admin',                  │ │
│ │                   │   │   'violation_text': 'container capabilities must │ │
│ │                   drop SYS_ADMIN'                                        │ │
│ │                   │   },                                                 │ │
│ │                   │   {                                                  │ │
│ │                   │   │   'id': '008',                                   │ │
│ │                   │   │   'manifest_path': 'data/manifests/002.yaml',    │ │
│ │                   │   │   'manifest_yaml': 'apiVersion: v1\nkind:        │ │
│ │                   Pod\nmetadata:\n  name: privileged-pod\n  namespace:   │ │
│ │                   default\ns'+142,                                       │ │
│ │                   │   │   'policy_id': 'no-read-only-root-fs',           │ │
│ │                   │   │   'violation_text': 'container "ubuntu" does not │ │
│ │                   have a read-only root file system'                     │ │
│ │                   │   },                                                 │ │
│ │                   │   {                                                  │ │
│ │                   │   │   'id': '009',                                   │ │
│ │                   │   │   'manifest_path': 'data/manifests/002.yaml',    │ │
│ │                   │   │   'manifest_yaml': 'apiVersion: v1\nkind:        │ │
│ │                   Pod\nmetadata:\n  name: privileged-pod\n  namespace:   │ │
│ │                   default\ns'+142,                                       │ │
│ │                   │   │   'policy_id': 'privilege-escalation-container', │ │
│ │                   │   │   'violation_text': 'container "ubuntu" is       │ │
│ │                   Privileged hence allows privilege escalation.'         │ │
│ │                   │   },                                                 │ │
│ │                   │   {                                                  │ │
│ │                   │   │   'id': '010',                                   │ │
│ │                   │   │   'manifest_path': 'data/manifests/002.yaml',    │ │
│ │                   │   │   'manifest_yaml': 'apiVersion: v1\nkind:        │ │
│ │                   Pod\nmetadata:\n  name: privileged-pod\n  namespace:   │ │
│ │                   default\ns'+142,                                       │ │
│ │                   │   │   'policy_id': 'privileged-container',           │ │
│ │                   │   │   'violation_text': 'container "ubuntu" is       │ │
│ │                   privileged'                                            │ │
│ │                   │   },                                                 │ │
│ │                   │   ... +14366                                         │ │
│ │                   ]                                                      │ │
│ │       generator = <__main__._GeneratorWrapper object at 0x1033920f0>     │ │
│ │            jobs = 1                                                      │ │
│ │    max_attempts = 3                                                      │ │
│ │     metrics_out = None                                                   │ │
│ │            mode = 'rules'                                                │ │
│ │             out = PosixPath('/Users/brianmendonca/Downloads/untitled     │ │
│ │                   folder/k8s-auto-fix/data/patches_live.json')           │ │
│ │         patches = [                                                      │ │
│ │                   │   {                                                  │ │
│ │                   │   │   'id': '001',                                   │ │
│ │                   │   │   'policy_id': 'drop_cap_sys_admin',             │ │
│ │                   │   │   'source': 'rules',                             │ │
│ │                   │   │   'hardened': True,                              │ │
│ │                   │   │   'patch': [                                     │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext',                  │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'capabilities': {                  │ │
│ │                   │   │   │   │   │   │   'drop': [                      │ │
│ │                   │   │   │   │   │   │   │   'SYS_ADMIN',               │ │
│ │                   │   │   │   │   │   │   │   'ALL',                     │ │
│ │                   │   │   │   │   │   │   │   'NET_RAW',                 │ │
│ │                   │   │   │   │   │   │   │   'NET_ADMIN',               │ │
│ │                   │   │   │   │   │   │   │   'SYS_MODULE',              │ │
│ │                   │   │   │   │   │   │   │   'SYS_PTRACE',              │ │
│ │                   │   │   │   │   │   │   │   'SYS_CHROOT'               │ │
│ │                   │   │   │   │   │   │   ]                              │ │
│ │                   │   │   │   │   │   },                                 │ │
│ │                   │   │   │   │   │   'allowPrivilegeEscalation': False, │ │
│ │                   │   │   │   │   │   'privileged': False,               │ │
│ │                   │   │   │   │   │   'runAsNonRoot': True,              │ │
│ │                   │   │   │   │   │   'readOnlyRootFilesystem': True     │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/capabilities/drop… │ │
│ │                   │   │   │   │   'value': 'ALL'                         │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/capabilities/drop… │ │
│ │                   │   │   │   │   'value': 'NET_RAW'                     │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/capabilities/drop… │ │
│ │                   │   │   │   │   'value': 'NET_ADMIN'                   │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/capabilities/drop… │ │
│ │                   │   │   │   │   'value': 'SYS_MODULE'                  │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/capabilities/drop… │ │
│ │                   │   │   │   │   'value': 'SYS_PTRACE'                  │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/capabilities/drop… │ │
│ │                   │   │   │   │   'value': 'SYS_CHROOT'                  │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/privileged',       │ │
│ │                   │   │   │   │   'value': False                         │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'replace',                       │ │
│ │                   │   │   │   │   'path': '/spec/containers/0/image',    │ │
│ │                   │   │   │   │   'value': 'nginx:stable'                │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/resources',                        │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'requests': {                      │ │
│ │                   │   │   │   │   │   │   'cpu': '100m',                 │ │
│ │                   │   │   │   │   │   │   'memory': '128Mi'              │ │
│ │                   │   │   │   │   │   },                                 │ │
│ │                   │   │   │   │   │   'limits': {                        │ │
│ │                   │   │   │   │   │   │   'cpu': '500m',                 │ │
│ │                   │   │   │   │   │   │   'memory': '256Mi'              │ │
│ │                   │   │   │   │   │   }                                  │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   ... +2                                     │ │
│ │                   │   │   ],                                             │ │
│ │                   │   │   'latency_ms': 1,                               │ │
│ │                   │   │   'total_latency_ms': 1                          │ │
│ │                   │   },                                                 │ │
│ │                   │   {                                                  │ │
│ │                   │   │   'id': '002',                                   │ │
│ │                   │   │   'policy_id': 'no_latest_tag',                  │ │
│ │                   │   │   'source': 'rules',                             │ │
│ │                   │   │   'hardened': True,                              │ │
│ │                   │   │   'patch': [                                     │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'replace',                       │ │
│ │                   │   │   │   │   'path': '/spec/containers/0/image',    │ │
│ │                   │   │   │   │   'value': 'nginx:stable'                │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext',                  │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'capabilities': {                  │ │
│ │                   │   │   │   │   │   │   'drop': [                      │ │
│ │                   │   │   │   │   │   │   │   'ALL',                     │ │
│ │                   │   │   │   │   │   │   │   'NET_RAW',                 │ │
│ │                   │   │   │   │   │   │   │   'NET_ADMIN',               │ │
│ │                   │   │   │   │   │   │   │   'SYS_ADMIN',               │ │
│ │                   │   │   │   │   │   │   │   'SYS_MODULE',              │ │
│ │                   │   │   │   │   │   │   │   'SYS_PTRACE',              │ │
│ │                   │   │   │   │   │   │   │   'SYS_CHROOT'               │ │
│ │                   │   │   │   │   │   │   ]                              │ │
│ │                   │   │   │   │   │   },                                 │ │
│ │                   │   │   │   │   │   'privileged': False,               │ │
│ │                   │   │   │   │   │   'allowPrivilegeEscalation': False, │ │
│ │                   │   │   │   │   │   'runAsNonRoot': True,              │ │
│ │                   │   │   │   │   │   'readOnlyRootFilesystem': True     │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/capabilities',     │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'drop': [                          │ │
│ │                   │   │   │   │   │   │   'ALL',                         │ │
│ │                   │   │   │   │   │   │   'NET_RAW',                     │ │
│ │                   │   │   │   │   │   │   'NET_ADMIN',                   │ │
│ │                   │   │   │   │   │   │   'SYS_ADMIN',                   │ │
│ │                   │   │   │   │   │   │   'SYS_MODULE',                  │ │
│ │                   │   │   │   │   │   │   'SYS_PTRACE',                  │ │
│ │                   │   │   │   │   │   │   'SYS_CHROOT'                   │ │
│ │                   │   │   │   │   │   ]                                  │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/privileged',       │ │
│ │                   │   │   │   │   'value': False                         │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/allowPrivilegeEsc… │ │
│ │                   │   │   │   │   'value': False                         │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/resources',                        │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'requests': {                      │ │
│ │                   │   │   │   │   │   │   'cpu': '100m',                 │ │
│ │                   │   │   │   │   │   │   'memory': '128Mi'              │ │
│ │                   │   │   │   │   │   },                                 │ │
│ │                   │   │   │   │   │   'limits': {                        │ │
│ │                   │   │   │   │   │   │   'cpu': '500m',                 │ │
│ │                   │   │   │   │   │   │   'memory': '256Mi'              │ │
│ │                   │   │   │   │   │   }                                  │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/runAsNonRoot',     │ │
│ │                   │   │   │   │   'value': True                          │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/readOnlyRootFiles… │ │
│ │                   │   │   │   │   'value': True                          │ │
│ │                   │   │   │   }                                          │ │
│ │                   │   │   ],                                             │ │
│ │                   │   │   'latency_ms': 1,                               │ │
│ │                   │   │   'total_latency_ms': 1                          │ │
│ │                   │   },                                                 │ │
│ │                   │   {                                                  │ │
│ │                   │   │   'id': '003',                                   │ │
│ │                   │   │   'policy_id': 'read_only_root_fs',              │ │
│ │                   │   │   'source': 'rules',                             │ │
│ │                   │   │   'hardened': True,                              │ │
│ │                   │   │   'patch': [                                     │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext',                  │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'readOnlyRootFilesystem': True,    │ │
│ │                   │   │   │   │   │   'privileged': False,               │ │
│ │                   │   │   │   │   │   'capabilities': {                  │ │
│ │                   │   │   │   │   │   │   'drop': [                      │ │
│ │                   │   │   │   │   │   │   │   'ALL',                     │ │
│ │                   │   │   │   │   │   │   │   'NET_RAW',                 │ │
│ │                   │   │   │   │   │   │   │   'NET_ADMIN',               │ │
│ │                   │   │   │   │   │   │   │   'SYS_ADMIN',               │ │
│ │                   │   │   │   │   │   │   │   'SYS_MODULE',              │ │
│ │                   │   │   │   │   │   │   │   'SYS_PTRACE',              │ │
│ │                   │   │   │   │   │   │   │   'SYS_CHROOT'               │ │
│ │                   │   │   │   │   │   │   ]                              │ │
│ │                   │   │   │   │   │   },                                 │ │
│ │                   │   │   │   │   │   'allowPrivilegeEscalation': False, │ │
│ │                   │   │   │   │   │   'runAsNonRoot': True               │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/readOnlyRootFiles… │ │
│ │                   │   │   │   │   'value': True                          │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/privileged',       │ │
│ │                   │   │   │   │   'value': False                         │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/capabilities',     │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'drop': [                          │ │
│ │                   │   │   │   │   │   │   'ALL',                         │ │
│ │                   │   │   │   │   │   │   'NET_RAW',                     │ │
│ │                   │   │   │   │   │   │   'NET_ADMIN',                   │ │
│ │                   │   │   │   │   │   │   'SYS_ADMIN',                   │ │
│ │                   │   │   │   │   │   │   'SYS_MODULE',                  │ │
│ │                   │   │   │   │   │   │   'SYS_PTRACE',                  │ │
│ │                   │   │   │   │   │   │   'SYS_CHROOT'                   │ │
│ │                   │   │   │   │   │   ]                                  │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/allowPrivilegeEsc… │ │
│ │                   │   │   │   │   'value': False                         │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'replace',                       │ │
│ │                   │   │   │   │   'path': '/spec/containers/0/image',    │ │
│ │                   │   │   │   │   'value': 'nginx:stable'                │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/resources',                        │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'requests': {                      │ │
│ │                   │   │   │   │   │   │   'cpu': '100m',                 │ │
│ │                   │   │   │   │   │   │   'memory': '128Mi'              │ │
│ │                   │   │   │   │   │   },                                 │ │
│ │                   │   │   │   │   │   'limits': {                        │ │
│ │                   │   │   │   │   │   │   'cpu': '500m',                 │ │
│ │                   │   │   │   │   │   │   'memory': '256Mi'              │ │
│ │                   │   │   │   │   │   }                                  │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/runAsNonRoot',     │ │
│ │                   │   │   │   │   'value': True                          │ │
│ │                   │   │   │   }                                          │ │
│ │                   │   │   ],                                             │ │
│ │                   │   │   'latency_ms': 1,                               │ │
│ │                   │   │   'total_latency_ms': 1                          │ │
│ │                   │   },                                                 │ │
│ │                   │   {                                                  │ │
│ │                   │   │   'id': '004',                                   │ │
│ │                   │   │   'policy_id': 'run_as_non_root',                │ │
│ │                   │   │   'source': 'rules',                             │ │
│ │                   │   │   'hardened': True,                              │ │
│ │                   │   │   'patch': [                                     │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext',                  │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'runAsNonRoot': True,              │ │
│ │                   │   │   │   │   │   'privileged': False,               │ │
│ │                   │   │   │   │   │   'capabilities': {                  │ │
│ │                   │   │   │   │   │   │   'drop': [                      │ │
│ │                   │   │   │   │   │   │   │   'ALL',                     │ │
│ │                   │   │   │   │   │   │   │   'NET_RAW',                 │ │
│ │                   │   │   │   │   │   │   │   'NET_ADMIN',               │ │
│ │                   │   │   │   │   │   │   │   'SYS_ADMIN',               │ │
│ │                   │   │   │   │   │   │   │   'SYS_MODULE',              │ │
│ │                   │   │   │   │   │   │   │   'SYS_PTRACE',              │ │
│ │                   │   │   │   │   │   │   │   'SYS_CHROOT'               │ │
│ │                   │   │   │   │   │   │   ]                              │ │
│ │                   │   │   │   │   │   },                                 │ │
│ │                   │   │   │   │   │   'allowPrivilegeEscalation': False, │ │
│ │                   │   │   │   │   │   'readOnlyRootFilesystem': True     │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/runAsNonRoot',     │ │
│ │                   │   │   │   │   'value': True                          │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/privileged',       │ │
│ │                   │   │   │   │   'value': False                         │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/capabilities',     │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'drop': [                          │ │
│ │                   │   │   │   │   │   │   'ALL',                         │ │
│ │                   │   │   │   │   │   │   'NET_RAW',                     │ │
│ │                   │   │   │   │   │   │   'NET_ADMIN',                   │ │
│ │                   │   │   │   │   │   │   'SYS_ADMIN',                   │ │
│ │                   │   │   │   │   │   │   'SYS_MODULE',                  │ │
│ │                   │   │   │   │   │   │   'SYS_PTRACE',                  │ │
│ │                   │   │   │   │   │   │   'SYS_CHROOT'                   │ │
│ │                   │   │   │   │   │   ]                                  │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/allowPrivilegeEsc… │ │
│ │                   │   │   │   │   'value': False                         │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'replace',                       │ │
│ │                   │   │   │   │   'path': '/spec/containers/0/image',    │ │
│ │                   │   │   │   │   'value': 'nginx:stable'                │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/resources',                        │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'requests': {                      │ │
│ │                   │   │   │   │   │   │   'cpu': '100m',                 │ │
│ │                   │   │   │   │   │   │   'memory': '128Mi'              │ │
│ │                   │   │   │   │   │   },                                 │ │
│ │                   │   │   │   │   │   'limits': {                        │ │
│ │                   │   │   │   │   │   │   'cpu': '500m',                 │ │
│ │                   │   │   │   │   │   │   'memory': '256Mi'              │ │
│ │                   │   │   │   │   │   }                                  │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/readOnlyRootFiles… │ │
│ │                   │   │   │   │   'value': True                          │ │
│ │                   │   │   │   }                                          │ │
│ │                   │   │   ],                                             │ │
│ │                   │   │   'latency_ms': 1,                               │ │
│ │                   │   │   'total_latency_ms': 1                          │ │
│ │                   │   },                                                 │ │
│ │                   │   {                                                  │ │
│ │                   │   │   'id': '005',                                   │ │
│ │                   │   │   'policy_id': 'set_requests_limits',            │ │
│ │                   │   │   'source': 'rules',                             │ │
│ │                   │   │   'hardened': True,                              │ │
│ │                   │   │   'patch': [                                     │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/resources',                        │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'requests': {                      │ │
│ │                   │   │   │   │   │   │   'cpu': '100m',                 │ │
│ │                   │   │   │   │   │   │   'memory': '128Mi'              │ │
│ │                   │   │   │   │   │   },                                 │ │
│ │                   │   │   │   │   │   'limits': {                        │ │
│ │                   │   │   │   │   │   │   'cpu': '500m',                 │ │
│ │                   │   │   │   │   │   │   'memory': '256Mi'              │ │
│ │                   │   │   │   │   │   }                                  │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext',                  │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'privileged': False,               │ │
│ │                   │   │   │   │   │   'capabilities': {                  │ │
│ │                   │   │   │   │   │   │   'drop': [                      │ │
│ │                   │   │   │   │   │   │   │   'ALL',                     │ │
│ │                   │   │   │   │   │   │   │   'NET_RAW',                 │ │
│ │                   │   │   │   │   │   │   │   'NET_ADMIN',               │ │
│ │                   │   │   │   │   │   │   │   'SYS_ADMIN',               │ │
│ │                   │   │   │   │   │   │   │   'SYS_MODULE',              │ │
│ │                   │   │   │   │   │   │   │   'SYS_PTRACE',              │ │
│ │                   │   │   │   │   │   │   │   'SYS_CHROOT'               │ │
│ │                   │   │   │   │   │   │   ]                              │ │
│ │                   │   │   │   │   │   },                                 │ │
│ │                   │   │   │   │   │   'allowPrivilegeEscalation': False, │ │
│ │                   │   │   │   │   │   'runAsNonRoot': True,              │ │
│ │                   │   │   │   │   │   'readOnlyRootFilesystem': True     │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/privileged',       │ │
│ │                   │   │   │   │   'value': False                         │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/capabilities',     │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'drop': [                          │ │
│ │                   │   │   │   │   │   │   'ALL',                         │ │
│ │                   │   │   │   │   │   │   'NET_RAW',                     │ │
│ │                   │   │   │   │   │   │   'NET_ADMIN',                   │ │
│ │                   │   │   │   │   │   │   'SYS_ADMIN',                   │ │
│ │                   │   │   │   │   │   │   'SYS_MODULE',                  │ │
│ │                   │   │   │   │   │   │   'SYS_PTRACE',                  │ │
│ │                   │   │   │   │   │   │   'SYS_CHROOT'                   │ │
│ │                   │   │   │   │   │   ]                                  │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/allowPrivilegeEsc… │ │
│ │                   │   │   │   │   'value': False                         │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'replace',                       │ │
│ │                   │   │   │   │   'path': '/spec/containers/0/image',    │ │
│ │                   │   │   │   │   'value': 'nginx:stable'                │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/runAsNonRoot',     │ │
│ │                   │   │   │   │   'value': True                          │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/readOnlyRootFiles… │ │
│ │                   │   │   │   │   'value': True                          │ │
│ │                   │   │   │   }                                          │ │
│ │                   │   │   ],                                             │ │
│ │                   │   │   'latency_ms': 0,                               │ │
│ │                   │   │   'total_latency_ms': 0                          │ │
│ │                   │   },                                                 │ │
│ │                   │   {                                                  │ │
│ │                   │   │   'id': '006',                                   │ │
│ │                   │   │   'policy_id': 'set_requests_limits',            │ │
│ │                   │   │   'source': 'rules',                             │ │
│ │                   │   │   'hardened': True,                              │ │
│ │                   │   │   'patch': [                                     │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/resources',                        │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'requests': {                      │ │
│ │                   │   │   │   │   │   │   'cpu': '100m',                 │ │
│ │                   │   │   │   │   │   │   'memory': '128Mi'              │ │
│ │                   │   │   │   │   │   },                                 │ │
│ │                   │   │   │   │   │   'limits': {                        │ │
│ │                   │   │   │   │   │   │   'cpu': '500m',                 │ │
│ │                   │   │   │   │   │   │   'memory': '256Mi'              │ │
│ │                   │   │   │   │   │   }                                  │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext',                  │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'privileged': False,               │ │
│ │                   │   │   │   │   │   'capabilities': {                  │ │
│ │                   │   │   │   │   │   │   'drop': [                      │ │
│ │                   │   │   │   │   │   │   │   'ALL',                     │ │
│ │                   │   │   │   │   │   │   │   'NET_RAW',                 │ │
│ │                   │   │   │   │   │   │   │   'NET_ADMIN',               │ │
│ │                   │   │   │   │   │   │   │   'SYS_ADMIN',               │ │
│ │                   │   │   │   │   │   │   │   'SYS_MODULE',              │ │
│ │                   │   │   │   │   │   │   │   'SYS_PTRACE',              │ │
│ │                   │   │   │   │   │   │   │   'SYS_CHROOT'               │ │
│ │                   │   │   │   │   │   │   ]                              │ │
│ │                   │   │   │   │   │   },                                 │ │
│ │                   │   │   │   │   │   'allowPrivilegeEscalation': False, │ │
│ │                   │   │   │   │   │   'runAsNonRoot': True,              │ │
│ │                   │   │   │   │   │   'readOnlyRootFilesystem': True     │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/privileged',       │ │
│ │                   │   │   │   │   'value': False                         │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/capabilities',     │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'drop': [                          │ │
│ │                   │   │   │   │   │   │   'ALL',                         │ │
│ │                   │   │   │   │   │   │   'NET_RAW',                     │ │
│ │                   │   │   │   │   │   │   'NET_ADMIN',                   │ │
│ │                   │   │   │   │   │   │   'SYS_ADMIN',                   │ │
│ │                   │   │   │   │   │   │   'SYS_MODULE',                  │ │
│ │                   │   │   │   │   │   │   'SYS_PTRACE',                  │ │
│ │                   │   │   │   │   │   │   'SYS_CHROOT'                   │ │
│ │                   │   │   │   │   │   ]                                  │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/allowPrivilegeEsc… │ │
│ │                   │   │   │   │   'value': False                         │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'replace',                       │ │
│ │                   │   │   │   │   'path': '/spec/containers/0/image',    │ │
│ │                   │   │   │   │   'value': 'nginx:stable'                │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/runAsNonRoot',     │ │
│ │                   │   │   │   │   'value': True                          │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/readOnlyRootFiles… │ │
│ │                   │   │   │   │   'value': True                          │ │
│ │                   │   │   │   }                                          │ │
│ │                   │   │   ],                                             │ │
│ │                   │   │   'latency_ms': 0,                               │ │
│ │                   │   │   'total_latency_ms': 0                          │ │
│ │                   │   },                                                 │ │
│ │                   │   {                                                  │ │
│ │                   │   │   'id': '007',                                   │ │
│ │                   │   │   'policy_id': 'drop_cap_sys_admin',             │ │
│ │                   │   │   'source': 'rules',                             │ │
│ │                   │   │   'hardened': True,                              │ │
│ │                   │   │   'patch': [                                     │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/capabilities',     │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'drop': [                          │ │
│ │                   │   │   │   │   │   │   'SYS_ADMIN',                   │ │
│ │                   │   │   │   │   │   │   'ALL',                         │ │
│ │                   │   │   │   │   │   │   'NET_RAW',                     │ │
│ │                   │   │   │   │   │   │   'NET_ADMIN',                   │ │
│ │                   │   │   │   │   │   │   'SYS_MODULE',                  │ │
│ │                   │   │   │   │   │   │   'SYS_PTRACE',                  │ │
│ │                   │   │   │   │   │   │   'SYS_CHROOT'                   │ │
│ │                   │   │   │   │   │   ]                                  │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/allowPrivilegeEsc… │ │
│ │                   │   │   │   │   'value': False                         │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/capabilities/drop… │ │
│ │                   │   │   │   │   'value': 'ALL'                         │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/capabilities/drop… │ │
│ │                   │   │   │   │   'value': 'NET_RAW'                     │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/capabilities/drop… │ │
│ │                   │   │   │   │   'value': 'NET_ADMIN'                   │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/capabilities/drop… │ │
│ │                   │   │   │   │   'value': 'SYS_MODULE'                  │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/capabilities/drop… │ │
│ │                   │   │   │   │   'value': 'SYS_PTRACE'                  │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/capabilities/drop… │ │
│ │                   │   │   │   │   'value': 'SYS_CHROOT'                  │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'replace',                       │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/privileged',       │ │
│ │                   │   │   │   │   'value': False                         │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/resources',                        │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'requests': {                      │ │
│ │                   │   │   │   │   │   │   'cpu': '100m',                 │ │
│ │                   │   │   │   │   │   │   'memory': '128Mi'              │ │
│ │                   │   │   │   │   │   },                                 │ │
│ │                   │   │   │   │   │   'limits': {                        │ │
│ │                   │   │   │   │   │   │   'cpu': '500m',                 │ │
│ │                   │   │   │   │   │   │   'memory': '256Mi'              │ │
│ │                   │   │   │   │   │   }                                  │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   ... +2                                     │ │
│ │                   │   │   ],                                             │ │
│ │                   │   │   'latency_ms': 1,                               │ │
│ │                   │   │   'total_latency_ms': 1                          │ │
│ │                   │   },                                                 │ │
│ │                   │   {                                                  │ │
│ │                   │   │   'id': '008',                                   │ │
│ │                   │   │   'policy_id': 'read_only_root_fs',              │ │
│ │                   │   │   'source': 'rules',                             │ │
│ │                   │   │   'hardened': True,                              │ │
│ │                   │   │   'patch': [                                     │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/readOnlyRootFiles… │ │
│ │                   │   │   │   │   'value': True                          │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'replace',                       │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/privileged',       │ │
│ │                   │   │   │   │   'value': False                         │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/capabilities',     │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'drop': [                          │ │
│ │                   │   │   │   │   │   │   'ALL',                         │ │
│ │                   │   │   │   │   │   │   'NET_RAW',                     │ │
│ │                   │   │   │   │   │   │   'NET_ADMIN',                   │ │
│ │                   │   │   │   │   │   │   'SYS_ADMIN',                   │ │
│ │                   │   │   │   │   │   │   'SYS_MODULE',                  │ │
│ │                   │   │   │   │   │   │   'SYS_PTRACE',                  │ │
│ │                   │   │   │   │   │   │   'SYS_CHROOT'                   │ │
│ │                   │   │   │   │   │   ]                                  │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/allowPrivilegeEsc… │ │
│ │                   │   │   │   │   'value': False                         │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/resources',                        │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'requests': {                      │ │
│ │                   │   │   │   │   │   │   'cpu': '100m',                 │ │
│ │                   │   │   │   │   │   │   'memory': '128Mi'              │ │
│ │                   │   │   │   │   │   },                                 │ │
│ │                   │   │   │   │   │   'limits': {                        │ │
│ │                   │   │   │   │   │   │   'cpu': '500m',                 │ │
│ │                   │   │   │   │   │   │   'memory': '256Mi'              │ │
│ │                   │   │   │   │   │   }                                  │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/runAsNonRoot',     │ │
│ │                   │   │   │   │   'value': True                          │ │
│ │                   │   │   │   }                                          │ │
│ │                   │   │   ],                                             │ │
│ │                   │   │   'latency_ms': 0,                               │ │
│ │                   │   │   'total_latency_ms': 0                          │ │
│ │                   │   },                                                 │ │
│ │                   │   {                                                  │ │
│ │                   │   │   'id': '009',                                   │ │
│ │                   │   │   'policy_id': 'drop_capabilities',              │ │
│ │                   │   │   'source': 'rules',                             │ │
│ │                   │   │   'hardened': True,                              │ │
│ │                   │   │   'patch': [                                     │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/capabilities',     │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'drop': [                          │ │
│ │                   │   │   │   │   │   │   'ALL',                         │ │
│ │                   │   │   │   │   │   │   'NET_RAW',                     │ │
│ │                   │   │   │   │   │   │   'NET_ADMIN',                   │ │
│ │                   │   │   │   │   │   │   'SYS_ADMIN',                   │ │
│ │                   │   │   │   │   │   │   'SYS_MODULE',                  │ │
│ │                   │   │   │   │   │   │   'SYS_PTRACE',                  │ │
│ │                   │   │   │   │   │   │   'SYS_CHROOT'                   │ │
│ │                   │   │   │   │   │   ]                                  │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'replace',                       │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/privileged',       │ │
│ │                   │   │   │   │   'value': False                         │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/allowPrivilegeEsc… │ │
│ │                   │   │   │   │   'value': False                         │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/resources',                        │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'requests': {                      │ │
│ │                   │   │   │   │   │   │   'cpu': '100m',                 │ │
│ │                   │   │   │   │   │   │   'memory': '128Mi'              │ │
│ │                   │   │   │   │   │   },                                 │ │
│ │                   │   │   │   │   │   'limits': {                        │ │
│ │                   │   │   │   │   │   │   'cpu': '500m',                 │ │
│ │                   │   │   │   │   │   │   'memory': '256Mi'              │ │
│ │                   │   │   │   │   │   }                                  │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/runAsNonRoot',     │ │
│ │                   │   │   │   │   'value': True                          │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/readOnlyRootFiles… │ │
│ │                   │   │   │   │   'value': True                          │ │
│ │                   │   │   │   }                                          │ │
│ │                   │   │   ],                                             │ │
│ │                   │   │   'latency_ms': 0,                               │ │
│ │                   │   │   'total_latency_ms': 0                          │ │
│ │                   │   },                                                 │ │
│ │                   │   {                                                  │ │
│ │                   │   │   'id': '010',                                   │ │
│ │                   │   │   'policy_id': 'no_privileged',                  │ │
│ │                   │   │   'source': 'rules',                             │ │
│ │                   │   │   'hardened': True,                              │ │
│ │                   │   │   'patch': [                                     │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'replace',                       │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/privileged',       │ │
│ │                   │   │   │   │   'value': False                         │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/capabilities',     │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'drop': [                          │ │
│ │                   │   │   │   │   │   │   'ALL',                         │ │
│ │                   │   │   │   │   │   │   'NET_RAW',                     │ │
│ │                   │   │   │   │   │   │   'NET_ADMIN',                   │ │
│ │                   │   │   │   │   │   │   'SYS_ADMIN',                   │ │
│ │                   │   │   │   │   │   │   'SYS_MODULE',                  │ │
│ │                   │   │   │   │   │   │   'SYS_PTRACE',                  │ │
│ │                   │   │   │   │   │   │   'SYS_CHROOT'                   │ │
│ │                   │   │   │   │   │   ]                                  │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/allowPrivilegeEsc… │ │
│ │                   │   │   │   │   'value': False                         │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/resources',                        │ │
│ │                   │   │   │   │   'value': {                             │ │
│ │                   │   │   │   │   │   'requests': {                      │ │
│ │                   │   │   │   │   │   │   'cpu': '100m',                 │ │
│ │                   │   │   │   │   │   │   'memory': '128Mi'              │ │
│ │                   │   │   │   │   │   },                                 │ │
│ │                   │   │   │   │   │   'limits': {                        │ │
│ │                   │   │   │   │   │   │   'cpu': '500m',                 │ │
│ │                   │   │   │   │   │   │   'memory': '256Mi'              │ │
│ │                   │   │   │   │   │   }                                  │ │
│ │                   │   │   │   │   }                                      │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/runAsNonRoot',     │ │
│ │                   │   │   │   │   'value': True                          │ │
│ │                   │   │   │   },                                         │ │
│ │                   │   │   │   {                                          │ │
│ │                   │   │   │   │   'op': 'add',                           │ │
│ │                   │   │   │   │   'path':                                │ │
│ │                   '/spec/containers/0/securityContext/readOnlyRootFiles… │ │
│ │                   │   │   │   │   'value': True                          │ │
│ │                   │   │   │   }                                          │ │
│ │                   │   │   ],                                             │ │
│ │                   │   │   'latency_ms': 2,                               │ │
│ │                   │   │   'total_latency_ms': 2                          │ │
│ │                   │   },                                                 │ │
│ │                   │   ... +1735                                          │ │
│ │                   ]                                                      │ │
│ │          record = {                                                      │ │
│ │                   │   'id': '2059',                                      │ │
│ │                   │   'manifest_path':                                   │ │
│ │                   'data/manifests/the_stack_sample/sample_0350.yaml',    │ │
│ │                   │   'manifest_yaml': 'apiVersion: apps/v1\nkind:       │ │
│ │                   Deployment\nmetadata:\n  name: kurl-proxy-kotsadm\n    │ │
│ │                   labe'+1208,                                            │ │
│ │                   │   'policy_id': 'cap-sys-admin',                      │ │
│ │                   │   'violation_text': 'container capabilities must     │ │
│ │                   drop SYS_ADMIN'                                        │ │
│ │                   }                                                      │ │
│ │             rng = <random.Random object at 0x133884c20>                  │ │
│ │            seed = 1337                                                   │ │
│ ╰──────────────────────────────────────────────────────────────────────────╯ │
│                                                                              │
│ /Users/brianmendonca/Downloads/untitled                                      │
│ folder/k8s-auto-fix/src/proposer/cli.py:273 in _generate_patch_record        │
│                                                                              │
│    270 │   │   │   patch_ops = rule_guard_ops                                │
│    271 │   │   │   hardened = True                                           │
│    272 │   │   else:                                                         │
│ ❱  273 │   │   │   raise RuntimeError(                                       │
│    274 │   │   │   │   f"Unable to produce patch for detection {detection_id │
│    275 │   │   │   )                                                         │
│    276                                                                       │
│                                                                              │
│ ╭───────────────────────────────── locals ─────────────────────────────────╮ │
│ │         attempt_start = 139980.1152795                                   │ │
│ │              attempts = 3                                                │ │
│ │              base_dir = PosixPath('/Users/brianmendonca/Downloads/untit… │ │
│ │                         folder/k8s-auto-fix/data')                       │ │
│ │           config_data = {                                                │ │
│ │                         │   'grok': {                                    │ │
│ │                         │   │   'api_key_env': 'XAI_API_KEY',            │ │
│ │                         │   │   'auth_header': 'Authorization',          │ │
│ │                         │   │   'auth_scheme': 'Bearer',                 │ │
│ │                         │   │   'endpoint':                              │ │
│ │                         'https://api.x.ai/v1/chat/completions',          │ │
│ │                         │   │   'model': 'grok-4-fast-reasoning'         │ │
│ │                         │   },                                           │ │
│ │                         │   'max_attempts': 3,                           │ │
│ │                         │   'proposer': {                                │ │
│ │                         │   │   'mode': 'rules',                         │ │
│ │                         │   │   'retries': 2,                            │ │
│ │                         │   │   'timeout_seconds': 60                    │ │
│ │                         │   },                                           │ │
│ │                         │   'rules': {'enabled': True},                  │ │
│ │                         │   'seed': 1337,                                │ │
│ │                         │   'vendor': {                                  │ │
│ │                         │   │   'api_key_env': 'OPENAI_API_KEY',         │ │
│ │                         │   │   'endpoint':                              │ │
│ │                         'https://api.openai.com/v1/chat/completions',    │ │
│ │                         │   │   'model': 'gpt-4o-mini'                   │ │
│ │                         │   },                                           │ │
│ │                         │   'vllm': {                                    │ │
│ │                         │   │   'api_key_env': 'RUNPOD_API_KEY',         │ │
│ │                         │   │   'endpoint':                              │ │
│ │                         'https://<RUNPOD_ENDPOINT>/v1/chat/completions', │ │
│ │                         │   │   'model':                                 │ │
│ │                         'meta-llama/Meta-Llama-3-8B-Instruct'            │ │
│ │                         │   }                                            │ │
│ │                         }                                                │ │
│ │             detection = {                                                │ │
│ │                         │   'id': '2059',                                │ │
│ │                         │   'policy_id': 'drop_cap_sys_admin',           │ │
│ │                         │   'violation_text': 'container capabilities    │ │
│ │                         must drop SYS_ADMIN',                            │ │
│ │                         │   'manifest_yaml': 'apiVersion: apps/v1\nkind: │ │
│ │                         Deployment\nmetadata:\n  name:                   │ │
│ │                         kurl-proxy-kotsadm\n  labe'+1208                 │ │
│ │                         }                                                │ │
│ │  detection_for_prompt = {                                                │ │
│ │                         │   'id': '2059',                                │ │
│ │                         │   'policy_id': 'drop_cap_sys_admin',           │ │
│ │                         │   'violation_text': 'container capabilities    │ │
│ │                         must drop SYS_ADMIN',                            │ │
│ │                         │   'manifest_yaml': 'apiVersion: apps/v1\nkind: │ │
│ │                         Deployment\nmetadata:\n  name:                   │ │
│ │                         kurl-proxy-kotsadm\n  labe'+1208,                │ │
│ │                         │   'retry_feedback': "bad path or conflict:     │ │
│ │                         can't replace a non-existent object              │ │
│ │                         'kots.io~1kotsadm'; ba"+74                       │ │
│ │                         }                                                │ │
│ │          detection_id = '2059'                                           │ │
│ │                errors = [                                                │ │
│ │                         │   "bad path or conflict: can't replace a       │ │
│ │                         non-existent object 'kots.io~1kotsadm'",         │ │
│ │                         │   "bad path or conflict: can't replace a       │ │
│ │                         non-existent object 'kots.io~1kotsadm'",         │ │
│ │                         │   "bad path or conflict: can't replace a       │ │
│ │                         non-existent object 'kots.io~1kotsadm'"          │ │
│ │                         ]                                                │ │
│ │            generation = [                                                │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': {                               │ │
│ │                         │   │   │   'capabilities': {                    │ │
│ │                         │   │   │   │   'drop': ['SYS_ADMIN']            │ │
│ │                         │   │   │   },                                   │ │
│ │                         │   │   │   'allowPrivilegeEscalation': False    │ │
│ │                         │   │   }                                        │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'replace',                         │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/metadata/labels/kots.io~1kotsadm',             │ │
│ │                         │   │   'value': 'true'                          │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'replace',                         │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/metadata/labels/kots.io~1kotsad… │ │
│ │                         │   │   'value': 'true'                          │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': 'ALL'                           │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': 'NET_RAW'                       │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': 'NET_ADMIN'                     │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': 'SYS_MODULE'                    │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': 'SYS_PTRACE'                    │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': 'SYS_CHROOT'                    │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': False                           │ │
│ │                         │   },                                           │ │
│ │                         │   ... +3                                       │ │
│ │                         ]                                                │ │
│ │ generation_latency_ms = None                                             │ │
│ │      generation_usage = None                                             │ │
│ │             generator = <__main__._GeneratorWrapper object at            │ │
│ │                         0x1033920f0>                                     │ │
│ │              hardened = True                                             │ │
│ │       local_generator = <__main__._GeneratorWrapper object at            │ │
│ │                         0x1033920f0>                                     │ │
│ │             local_rng = <random.Random object at 0x133884c20>            │ │
│ │         manifest_yaml = 'apiVersion: apps/v1\nkind:                      │ │
│ │                         Deployment\nmetadata:\n  name:                   │ │
│ │                         kurl-proxy-kotsadm\n  labe'+1208                 │ │
│ │          max_attempts = 3                                                │ │
│ │               message = "bad path or conflict: can't replace a           │ │
│ │                         non-existent object 'kots.io~1kotsadm'"          │ │
│ │                  mode = 'rules'                                          │ │
│ │         overall_start = 139980.105935625                                 │ │
│ │            patch_list = [                                                │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': {                               │ │
│ │                         │   │   │   'capabilities': {                    │ │
│ │                         │   │   │   │   'drop': ['SYS_ADMIN']            │ │
│ │                         │   │   │   },                                   │ │
│ │                         │   │   │   'allowPrivilegeEscalation': False    │ │
│ │                         │   │   }                                        │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'replace',                         │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/metadata/labels/kots.io~01kotsadm',            │ │
│ │                         │   │   'value': 'true'                          │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'replace',                         │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/metadata/labels/kots.io~01kotsa… │ │
│ │                         │   │   'value': 'true'                          │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': 'ALL'                           │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': 'NET_RAW'                       │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': 'NET_ADMIN'                     │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': 'SYS_MODULE'                    │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': 'SYS_PTRACE'                    │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': 'SYS_CHROOT'                    │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': False                           │ │
│ │                         │   },                                           │ │
│ │                         │   ... +3                                       │ │
│ │                         ]                                                │ │
│ │             patch_ops = None                                             │ │
│ │             policy_id = 'drop_cap_sys_admin'                             │ │
│ │             raw_patch = [                                                │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': {                               │ │
│ │                         │   │   │   'capabilities': {                    │ │
│ │                         │   │   │   │   'drop': ['SYS_ADMIN']            │ │
│ │                         │   │   │   },                                   │ │
│ │                         │   │   │   'allowPrivilegeEscalation': False    │ │
│ │                         │   │   }                                        │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'replace',                         │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/metadata/labels/kots.io~1kotsadm',             │ │
│ │                         │   │   'value': 'true'                          │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'replace',                         │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/metadata/labels/kots.io~1kotsad… │ │
│ │                         │   │   'value': 'true'                          │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': 'ALL'                           │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': 'NET_RAW'                       │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': 'NET_ADMIN'                     │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': 'SYS_MODULE'                    │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': 'SYS_PTRACE'                    │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': 'SYS_CHROOT'                    │ │
│ │                         │   },                                           │ │
│ │                         │   {                                            │ │
│ │                         │   │   'op': 'add',                             │ │
│ │                         │   │   'path':                                  │ │
│ │                         '/spec/template/spec/containers/0/securityConte… │ │
│ │                         │   │   'value': False                           │ │
│ │                         │   },                                           │ │
│ │                         │   ... +3                                       │ │
│ │                         ]                                                │ │
│ │                record = {                                                │ │
│ │                         │   'id': '2059',                                │ │
│ │                         │   'manifest_path':                             │ │
│ │                         'data/manifests/the_stack_sample/sample_0350.ya… │ │
│ │                         │   'manifest_yaml': 'apiVersion: apps/v1\nkind: │ │
│ │                         Deployment\nmetadata:\n  name:                   │ │
│ │                         kurl-proxy-kotsadm\n  labe'+1208,                │ │
│ │                         │   'policy_id': 'cap-sys-admin',                │ │
│ │                         │   'violation_text': 'container capabilities    │ │
│ │                         must drop SYS_ADMIN'                             │ │
│ │                         }                                                │ │
│ │                   rng = <random.Random object at 0x133884c20>            │ │
│ │              rng_seed = None                                             │ │
│ │        rule_guard_ops = []                                               │ │
│ │                  seed = 1337                                             │ │
│ ╰──────────────────────────────────────────────────────────────────────────╯ │
╰──────────────────────────────────────────────────────────────────────────────╯
RuntimeError: Unable to produce patch for detection 2059 after 3 attempts: ["bad
path or conflict: can't replace a non-existent object 'kots.io~1kotsadm'", "bad 
path or conflict: can't replace a non-existent object 'kots.io~1kotsadm'", "bad 
path or conflict: can't replace a non-existent object 'kots.io~1kotsadm'"]
