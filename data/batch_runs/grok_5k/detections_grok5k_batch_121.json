[
  {
    "id": "04841",
    "manifest_path": "data/manifests/the_stack_sample/sample_2198.yaml",
    "manifest_yaml": "apiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\n  labels:\n    env: test\nspec:\n  containers:\n  - name: nginx\n    image: nginx\n    imagePullPolicy: IfNotPresent\n",
    "policy_id": "unset-memory-requirements",
    "violation_text": "container \"nginx\" has memory limit 0"
  },
  {
    "id": "04842",
    "manifest_path": "data/manifests/the_stack_sample/sample_2199.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      name: nginx\n  template:\n    metadata:\n      name: nginx\n    spec:\n      containers:\n      - image: nginx:1.15.3\n        name: nginx\n        ports:\n        - containerPort: 80\n",
    "policy_id": "no-read-only-root-fs",
    "violation_text": "container \"nginx\" does not have a read-only root file system"
  },
  {
    "id": "04843",
    "manifest_path": "data/manifests/the_stack_sample/sample_2199.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      name: nginx\n  template:\n    metadata:\n      name: nginx\n    spec:\n      containers:\n      - image: nginx:1.15.3\n        name: nginx\n        ports:\n        - containerPort: 80\n",
    "policy_id": "run-as-non-root",
    "violation_text": "container \"nginx\" is not set to runAsNonRoot"
  },
  {
    "id": "04844",
    "manifest_path": "data/manifests/the_stack_sample/sample_2199.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      name: nginx\n  template:\n    metadata:\n      name: nginx\n    spec:\n      containers:\n      - image: nginx:1.15.3\n        name: nginx\n        ports:\n        - containerPort: 80\n",
    "policy_id": "unset-cpu-requirements",
    "violation_text": "container \"nginx\" has cpu request 0"
  },
  {
    "id": "04845",
    "manifest_path": "data/manifests/the_stack_sample/sample_2199.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      name: nginx\n  template:\n    metadata:\n      name: nginx\n    spec:\n      containers:\n      - image: nginx:1.15.3\n        name: nginx\n        ports:\n        - containerPort: 80\n",
    "policy_id": "unset-memory-requirements",
    "violation_text": "container \"nginx\" has memory limit 0"
  },
  {
    "id": "04846",
    "manifest_path": "data/manifests/the_stack_sample/sample_2201.yaml",
    "manifest_yaml": "apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: etcd-job\nspec:\n  template:\n    metadata:\n      name: etcd-job\n    spec:\n      containers:\n      - name: etcd-job\n        image: tenstartups/etcdctl\n        env:\n        - name: ETCDCTL_ENDPOINT\n          value: http://example-etcd-cluster-client-service:2379\n        command:\n        - etcdctl\n        - mkdir\n        - pod-list\n",
    "policy_id": "latest-tag",
    "violation_text": "The container \"etcd-job\" is using an invalid container image, \"tenstartups/etcdctl\". Please use images that are not blocked by the `BlockList` criteria : [\".*:(latest)$\" \"^[^:]*$\" \"(.*/[^:]+)$\"]"
  },
  {
    "id": "04847",
    "manifest_path": "data/manifests/the_stack_sample/sample_2201.yaml",
    "manifest_yaml": "apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: etcd-job\nspec:\n  template:\n    metadata:\n      name: etcd-job\n    spec:\n      containers:\n      - name: etcd-job\n        image: tenstartups/etcdctl\n        env:\n        - name: ETCDCTL_ENDPOINT\n          value: http://example-etcd-cluster-client-service:2379\n        command:\n        - etcdctl\n        - mkdir\n        - pod-list\n",
    "policy_id": "no-read-only-root-fs",
    "violation_text": "container \"etcd-job\" does not have a read-only root file system"
  },
  {
    "id": "04848",
    "manifest_path": "data/manifests/the_stack_sample/sample_2201.yaml",
    "manifest_yaml": "apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: etcd-job\nspec:\n  template:\n    metadata:\n      name: etcd-job\n    spec:\n      containers:\n      - name: etcd-job\n        image: tenstartups/etcdctl\n        env:\n        - name: ETCDCTL_ENDPOINT\n          value: http://example-etcd-cluster-client-service:2379\n        command:\n        - etcdctl\n        - mkdir\n        - pod-list\n",
    "policy_id": "run-as-non-root",
    "violation_text": "container \"etcd-job\" is not set to runAsNonRoot"
  },
  {
    "id": "04849",
    "manifest_path": "data/manifests/the_stack_sample/sample_2201.yaml",
    "manifest_yaml": "apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: etcd-job\nspec:\n  template:\n    metadata:\n      name: etcd-job\n    spec:\n      containers:\n      - name: etcd-job\n        image: tenstartups/etcdctl\n        env:\n        - name: ETCDCTL_ENDPOINT\n          value: http://example-etcd-cluster-client-service:2379\n        command:\n        - etcdctl\n        - mkdir\n        - pod-list\n",
    "policy_id": "unset-cpu-requirements",
    "violation_text": "container \"etcd-job\" has cpu request 0"
  },
  {
    "id": "04850",
    "manifest_path": "data/manifests/the_stack_sample/sample_2201.yaml",
    "manifest_yaml": "apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: etcd-job\nspec:\n  template:\n    metadata:\n      name: etcd-job\n    spec:\n      containers:\n      - name: etcd-job\n        image: tenstartups/etcdctl\n        env:\n        - name: ETCDCTL_ENDPOINT\n          value: http://example-etcd-cluster-client-service:2379\n        command:\n        - etcdctl\n        - mkdir\n        - pod-list\n",
    "policy_id": "unset-memory-requirements",
    "violation_text": "container \"etcd-job\" has memory limit 0"
  },
  {
    "id": "04851",
    "manifest_path": "data/manifests/the_stack_sample/sample_2203.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: paymentservice\n  labels:\n    app: paymentservice\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: paymentservice\n  template:\n    metadata:\n      labels:\n        app: paymentservice\n    spec:\n      containers:\n      - name: paymentservice\n        image: puzyrevyaroslav/hipster_frontend:v0.0.2\n        resources: {}\n        env:\n        - name: PORT\n          value: '8080'\n        - name: PRODUCT_CATALOG_SERVICE_ADDR\n          value: productcatalogservice:3550\n        - name: CURRENCY_SERVICE_ADDR\n          value: currencyservice:7000\n        - name: CART_SERVICE_ADDR\n          value: cartservice:7070\n        - name: RECOMMENDATION_SERVICE_ADDR\n          value: recommendationservice:8080\n        - name: SHIPPING_SERVICE_ADDR\n          value: shippingservice:50051\n        - name: CHECKOUT_SERVICE_ADDR\n          value: checkoutservice:5050\n        - name: AD_SERVICE_ADDR\n          value: adservice:9555\n",
    "policy_id": "no-read-only-root-fs",
    "violation_text": "container \"paymentservice\" does not have a read-only root file system"
  },
  {
    "id": "04852",
    "manifest_path": "data/manifests/the_stack_sample/sample_2203.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: paymentservice\n  labels:\n    app: paymentservice\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: paymentservice\n  template:\n    metadata:\n      labels:\n        app: paymentservice\n    spec:\n      containers:\n      - name: paymentservice\n        image: puzyrevyaroslav/hipster_frontend:v0.0.2\n        resources: {}\n        env:\n        - name: PORT\n          value: '8080'\n        - name: PRODUCT_CATALOG_SERVICE_ADDR\n          value: productcatalogservice:3550\n        - name: CURRENCY_SERVICE_ADDR\n          value: currencyservice:7000\n        - name: CART_SERVICE_ADDR\n          value: cartservice:7070\n        - name: RECOMMENDATION_SERVICE_ADDR\n          value: recommendationservice:8080\n        - name: SHIPPING_SERVICE_ADDR\n          value: shippingservice:50051\n        - name: CHECKOUT_SERVICE_ADDR\n          value: checkoutservice:5050\n        - name: AD_SERVICE_ADDR\n          value: adservice:9555\n",
    "policy_id": "run-as-non-root",
    "violation_text": "container \"paymentservice\" is not set to runAsNonRoot"
  },
  {
    "id": "04853",
    "manifest_path": "data/manifests/the_stack_sample/sample_2203.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: paymentservice\n  labels:\n    app: paymentservice\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: paymentservice\n  template:\n    metadata:\n      labels:\n        app: paymentservice\n    spec:\n      containers:\n      - name: paymentservice\n        image: puzyrevyaroslav/hipster_frontend:v0.0.2\n        resources: {}\n        env:\n        - name: PORT\n          value: '8080'\n        - name: PRODUCT_CATALOG_SERVICE_ADDR\n          value: productcatalogservice:3550\n        - name: CURRENCY_SERVICE_ADDR\n          value: currencyservice:7000\n        - name: CART_SERVICE_ADDR\n          value: cartservice:7070\n        - name: RECOMMENDATION_SERVICE_ADDR\n          value: recommendationservice:8080\n        - name: SHIPPING_SERVICE_ADDR\n          value: shippingservice:50051\n        - name: CHECKOUT_SERVICE_ADDR\n          value: checkoutservice:5050\n        - name: AD_SERVICE_ADDR\n          value: adservice:9555\n",
    "policy_id": "unset-cpu-requirements",
    "violation_text": "container \"paymentservice\" has cpu request 0"
  },
  {
    "id": "04854",
    "manifest_path": "data/manifests/the_stack_sample/sample_2203.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: paymentservice\n  labels:\n    app: paymentservice\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: paymentservice\n  template:\n    metadata:\n      labels:\n        app: paymentservice\n    spec:\n      containers:\n      - name: paymentservice\n        image: puzyrevyaroslav/hipster_frontend:v0.0.2\n        resources: {}\n        env:\n        - name: PORT\n          value: '8080'\n        - name: PRODUCT_CATALOG_SERVICE_ADDR\n          value: productcatalogservice:3550\n        - name: CURRENCY_SERVICE_ADDR\n          value: currencyservice:7000\n        - name: CART_SERVICE_ADDR\n          value: cartservice:7070\n        - name: RECOMMENDATION_SERVICE_ADDR\n          value: recommendationservice:8080\n        - name: SHIPPING_SERVICE_ADDR\n          value: shippingservice:50051\n        - name: CHECKOUT_SERVICE_ADDR\n          value: checkoutservice:5050\n        - name: AD_SERVICE_ADDR\n          value: adservice:9555\n",
    "policy_id": "unset-memory-requirements",
    "violation_text": "container \"paymentservice\" has memory limit 0"
  },
  {
    "id": "04855",
    "manifest_path": "data/manifests/the_stack_sample/sample_2206.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: mysql\nspec:\n  selector:\n    matchLabels:\n      app: mysql\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: mysql\n    spec:\n      initContainers:\n      - name: init-mysql\n        image: mysql:5.7\n        command:\n        - bash\n        - -c\n        - \"set -ex\\n# Generate mysql server-id from pod ordinal index.\\n[[ `hostname`\\\n          \\ =~ -([0-9]+)$ ]] || exit 1\\nordinal=${BASH_REMATCH[1]}\\necho [mysqld]\\\n          \\ > /mnt/conf.d/server-id.cnf\\n# Add an offset to avoid reserved server-id=0\\\n          \\ value.\\necho server-id=$((100 + $ordinal)) >> /mnt/conf.d/server-id.cnf\\n\\\n          # Copy appropriate conf.d files from config-map to emptyDir.\\nif [[ $ordinal\\\n          \\ -eq 0 ]]; then\\n  cp /mnt/config-map/master.cnf /mnt/conf.d/\\nelse\\n \\\n          \\ cp /mnt/config-map/slave.cnf /mnt/conf.d/\\nfi\\n\"\n        volumeMounts:\n        - name: conf\n          mountPath: /mnt/conf.d\n        - name: config-map\n          mountPath: /mnt/config-map\n      - name: clone-mysql\n        image: gcr.io/google-samples/xtrabackup:1.0\n        command:\n        - bash\n        - -c\n        - 'set -ex\n\n          # Skip the clone if data already exists.\n\n          [[ -d /var/lib/mysql/mysql ]] && exit 0\n\n          # Skip the clone on master (ordinal index 0).\n\n          [[ `hostname` =~ -([0-9]+)$ ]] || exit 1\n\n          ordinal=${BASH_REMATCH[1]}\n\n          [[ $ordinal -eq 0 ]] && exit 0\n\n          # Clone data from previous peer.\n\n          ncat --recv-only mysql-$(($ordinal-1)).mysql 3307 | xbstream -x -C /var/lib/mysql\n\n          # Prepare the backup.\n\n          xtrabackup --prepare --target-dir=/var/lib/mysql\n\n          '\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n      containers:\n      - name: mysql\n        image: mysql:5.7\n        env:\n        - name: MYSQL_ALLOW_EMPTY_PASSWORD\n          value: '1'\n        ports:\n        - name: mysql\n          containerPort: 3306\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 500m\n            memory: 1Gi\n        livenessProbe:\n          exec:\n            command:\n            - mysqladmin\n            - ping\n          initialDelaySeconds: 30\n          periodSeconds: 10\n          timeoutSeconds: 5\n        readinessProbe:\n          exec:\n            command:\n            - mysql\n            - -h\n            - 127.0.0.1\n            - -e\n            - SELECT 1\n          initialDelaySeconds: 5\n          periodSeconds: 2\n          timeoutSeconds: 1\n      - name: xtrabackup\n        image: gcr.io/google-samples/xtrabackup:1.0\n        ports:\n        - name: xtrabackup\n          containerPort: 3307\n        command:\n        - bash\n        - -c\n        - \"set -ex\\ncd /var/lib/mysql\\n\\n# Determine binlog position of cloned data,\\\n          \\ if any.\\nif [[ -f xtrabackup_slave_info ]]; then\\n  # XtraBackup already\\\n          \\ generated a partial \\\"CHANGE MASTER TO\\\" query\\n  # because we're cloning\\\n          \\ from an existing slave.\\n  mv xtrabackup_slave_info change_master_to.sql.in\\n\\\n          \\  # Ignore xtrabackup_binlog_info in this case (it's useless).\\n  rm -f\\\n          \\ xtrabackup_binlog_info\\nelif [[ -f xtrabackup_binlog_info ]]; then\\n \\\n          \\ # We're cloning directly from master. Parse binlog position.\\n  [[ `cat\\\n          \\ xtrabackup_binlog_info` =~ ^(.*?)[[:space:]]+(.*?)$ ]] || exit 1\\n  rm\\\n          \\ xtrabackup_binlog_info\\n  echo \\\"CHANGE MASTER TO MASTER_LOG_FILE='${BASH_REMATCH[1]}',\\\\\\\n          \\n        MASTER_LOG_POS=${BASH_REMATCH[2]}\\\" > change_master_to.sql.in\\n\\\n          fi\\n\\n# Check if we need to complete a clone by starting replication.\\n\\\n          if [[ -f change_master_to.sql.in ]]; then\\n  echo \\\"Waiting for mysqld to\\\n          \\ be ready (accepting connections)\\\"\\n  until mysql -h 127.0.0.1 -e \\\"SELECT\\\n          \\ 1\\\"; do sleep 1; done\\n\\n  echo \\\"Initializing replication from clone\\\n          \\ position\\\"\\n  # In case of container restart, attempt this at-most-once.\\n\\\n          \\  mv change_master_to.sql.in change_master_to.sql.orig\\n  mysql -h 127.0.0.1\\\n          \\ <<EOF\\n$(<change_master_to.sql.orig),\\n  MASTER_HOST='mysql-0.mysql',\\n\\\n          \\  MASTER_USER='root',\\n  MASTER_PASSWORD='',\\n  MASTER_CONNECT_RETRY=10;\\n\\\n          START SLAVE;\\nEOF\\nfi\\n\\n# Start a server to send backups when requested\\\n          \\ by peers.\\nexec ncat --listen --keep-open --send-only --max-conns=1 3307\\\n          \\ -c \\\\\\n  \\\"xtrabackup --backup --slave-info --stream=xbstream --host=127.0.0.1\\\n          \\ --user=root\\\"\\n\"\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 100m\n            memory: 100Mi\n      volumes:\n      - name: conf\n        emptyDir: {}\n      - name: config-map\n        configMap:\n          name: mysql\n",
    "policy_id": "no-read-only-root-fs",
    "violation_text": "container \"clone-mysql\" does not have a read-only root file system"
  },
  {
    "id": "04856",
    "manifest_path": "data/manifests/the_stack_sample/sample_2206.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: mysql\nspec:\n  selector:\n    matchLabels:\n      app: mysql\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: mysql\n    spec:\n      initContainers:\n      - name: init-mysql\n        image: mysql:5.7\n        command:\n        - bash\n        - -c\n        - \"set -ex\\n# Generate mysql server-id from pod ordinal index.\\n[[ `hostname`\\\n          \\ =~ -([0-9]+)$ ]] || exit 1\\nordinal=${BASH_REMATCH[1]}\\necho [mysqld]\\\n          \\ > /mnt/conf.d/server-id.cnf\\n# Add an offset to avoid reserved server-id=0\\\n          \\ value.\\necho server-id=$((100 + $ordinal)) >> /mnt/conf.d/server-id.cnf\\n\\\n          # Copy appropriate conf.d files from config-map to emptyDir.\\nif [[ $ordinal\\\n          \\ -eq 0 ]]; then\\n  cp /mnt/config-map/master.cnf /mnt/conf.d/\\nelse\\n \\\n          \\ cp /mnt/config-map/slave.cnf /mnt/conf.d/\\nfi\\n\"\n        volumeMounts:\n        - name: conf\n          mountPath: /mnt/conf.d\n        - name: config-map\n          mountPath: /mnt/config-map\n      - name: clone-mysql\n        image: gcr.io/google-samples/xtrabackup:1.0\n        command:\n        - bash\n        - -c\n        - 'set -ex\n\n          # Skip the clone if data already exists.\n\n          [[ -d /var/lib/mysql/mysql ]] && exit 0\n\n          # Skip the clone on master (ordinal index 0).\n\n          [[ `hostname` =~ -([0-9]+)$ ]] || exit 1\n\n          ordinal=${BASH_REMATCH[1]}\n\n          [[ $ordinal -eq 0 ]] && exit 0\n\n          # Clone data from previous peer.\n\n          ncat --recv-only mysql-$(($ordinal-1)).mysql 3307 | xbstream -x -C /var/lib/mysql\n\n          # Prepare the backup.\n\n          xtrabackup --prepare --target-dir=/var/lib/mysql\n\n          '\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n      containers:\n      - name: mysql\n        image: mysql:5.7\n        env:\n        - name: MYSQL_ALLOW_EMPTY_PASSWORD\n          value: '1'\n        ports:\n        - name: mysql\n          containerPort: 3306\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 500m\n            memory: 1Gi\n        livenessProbe:\n          exec:\n            command:\n            - mysqladmin\n            - ping\n          initialDelaySeconds: 30\n          periodSeconds: 10\n          timeoutSeconds: 5\n        readinessProbe:\n          exec:\n            command:\n            - mysql\n            - -h\n            - 127.0.0.1\n            - -e\n            - SELECT 1\n          initialDelaySeconds: 5\n          periodSeconds: 2\n          timeoutSeconds: 1\n      - name: xtrabackup\n        image: gcr.io/google-samples/xtrabackup:1.0\n        ports:\n        - name: xtrabackup\n          containerPort: 3307\n        command:\n        - bash\n        - -c\n        - \"set -ex\\ncd /var/lib/mysql\\n\\n# Determine binlog position of cloned data,\\\n          \\ if any.\\nif [[ -f xtrabackup_slave_info ]]; then\\n  # XtraBackup already\\\n          \\ generated a partial \\\"CHANGE MASTER TO\\\" query\\n  # because we're cloning\\\n          \\ from an existing slave.\\n  mv xtrabackup_slave_info change_master_to.sql.in\\n\\\n          \\  # Ignore xtrabackup_binlog_info in this case (it's useless).\\n  rm -f\\\n          \\ xtrabackup_binlog_info\\nelif [[ -f xtrabackup_binlog_info ]]; then\\n \\\n          \\ # We're cloning directly from master. Parse binlog position.\\n  [[ `cat\\\n          \\ xtrabackup_binlog_info` =~ ^(.*?)[[:space:]]+(.*?)$ ]] || exit 1\\n  rm\\\n          \\ xtrabackup_binlog_info\\n  echo \\\"CHANGE MASTER TO MASTER_LOG_FILE='${BASH_REMATCH[1]}',\\\\\\\n          \\n        MASTER_LOG_POS=${BASH_REMATCH[2]}\\\" > change_master_to.sql.in\\n\\\n          fi\\n\\n# Check if we need to complete a clone by starting replication.\\n\\\n          if [[ -f change_master_to.sql.in ]]; then\\n  echo \\\"Waiting for mysqld to\\\n          \\ be ready (accepting connections)\\\"\\n  until mysql -h 127.0.0.1 -e \\\"SELECT\\\n          \\ 1\\\"; do sleep 1; done\\n\\n  echo \\\"Initializing replication from clone\\\n          \\ position\\\"\\n  # In case of container restart, attempt this at-most-once.\\n\\\n          \\  mv change_master_to.sql.in change_master_to.sql.orig\\n  mysql -h 127.0.0.1\\\n          \\ <<EOF\\n$(<change_master_to.sql.orig),\\n  MASTER_HOST='mysql-0.mysql',\\n\\\n          \\  MASTER_USER='root',\\n  MASTER_PASSWORD='',\\n  MASTER_CONNECT_RETRY=10;\\n\\\n          START SLAVE;\\nEOF\\nfi\\n\\n# Start a server to send backups when requested\\\n          \\ by peers.\\nexec ncat --listen --keep-open --send-only --max-conns=1 3307\\\n          \\ -c \\\\\\n  \\\"xtrabackup --backup --slave-info --stream=xbstream --host=127.0.0.1\\\n          \\ --user=root\\\"\\n\"\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 100m\n            memory: 100Mi\n      volumes:\n      - name: conf\n        emptyDir: {}\n      - name: config-map\n        configMap:\n          name: mysql\n",
    "policy_id": "no-read-only-root-fs",
    "violation_text": "container \"init-mysql\" does not have a read-only root file system"
  },
  {
    "id": "04857",
    "manifest_path": "data/manifests/the_stack_sample/sample_2206.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: mysql\nspec:\n  selector:\n    matchLabels:\n      app: mysql\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: mysql\n    spec:\n      initContainers:\n      - name: init-mysql\n        image: mysql:5.7\n        command:\n        - bash\n        - -c\n        - \"set -ex\\n# Generate mysql server-id from pod ordinal index.\\n[[ `hostname`\\\n          \\ =~ -([0-9]+)$ ]] || exit 1\\nordinal=${BASH_REMATCH[1]}\\necho [mysqld]\\\n          \\ > /mnt/conf.d/server-id.cnf\\n# Add an offset to avoid reserved server-id=0\\\n          \\ value.\\necho server-id=$((100 + $ordinal)) >> /mnt/conf.d/server-id.cnf\\n\\\n          # Copy appropriate conf.d files from config-map to emptyDir.\\nif [[ $ordinal\\\n          \\ -eq 0 ]]; then\\n  cp /mnt/config-map/master.cnf /mnt/conf.d/\\nelse\\n \\\n          \\ cp /mnt/config-map/slave.cnf /mnt/conf.d/\\nfi\\n\"\n        volumeMounts:\n        - name: conf\n          mountPath: /mnt/conf.d\n        - name: config-map\n          mountPath: /mnt/config-map\n      - name: clone-mysql\n        image: gcr.io/google-samples/xtrabackup:1.0\n        command:\n        - bash\n        - -c\n        - 'set -ex\n\n          # Skip the clone if data already exists.\n\n          [[ -d /var/lib/mysql/mysql ]] && exit 0\n\n          # Skip the clone on master (ordinal index 0).\n\n          [[ `hostname` =~ -([0-9]+)$ ]] || exit 1\n\n          ordinal=${BASH_REMATCH[1]}\n\n          [[ $ordinal -eq 0 ]] && exit 0\n\n          # Clone data from previous peer.\n\n          ncat --recv-only mysql-$(($ordinal-1)).mysql 3307 | xbstream -x -C /var/lib/mysql\n\n          # Prepare the backup.\n\n          xtrabackup --prepare --target-dir=/var/lib/mysql\n\n          '\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n      containers:\n      - name: mysql\n        image: mysql:5.7\n        env:\n        - name: MYSQL_ALLOW_EMPTY_PASSWORD\n          value: '1'\n        ports:\n        - name: mysql\n          containerPort: 3306\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 500m\n            memory: 1Gi\n        livenessProbe:\n          exec:\n            command:\n            - mysqladmin\n            - ping\n          initialDelaySeconds: 30\n          periodSeconds: 10\n          timeoutSeconds: 5\n        readinessProbe:\n          exec:\n            command:\n            - mysql\n            - -h\n            - 127.0.0.1\n            - -e\n            - SELECT 1\n          initialDelaySeconds: 5\n          periodSeconds: 2\n          timeoutSeconds: 1\n      - name: xtrabackup\n        image: gcr.io/google-samples/xtrabackup:1.0\n        ports:\n        - name: xtrabackup\n          containerPort: 3307\n        command:\n        - bash\n        - -c\n        - \"set -ex\\ncd /var/lib/mysql\\n\\n# Determine binlog position of cloned data,\\\n          \\ if any.\\nif [[ -f xtrabackup_slave_info ]]; then\\n  # XtraBackup already\\\n          \\ generated a partial \\\"CHANGE MASTER TO\\\" query\\n  # because we're cloning\\\n          \\ from an existing slave.\\n  mv xtrabackup_slave_info change_master_to.sql.in\\n\\\n          \\  # Ignore xtrabackup_binlog_info in this case (it's useless).\\n  rm -f\\\n          \\ xtrabackup_binlog_info\\nelif [[ -f xtrabackup_binlog_info ]]; then\\n \\\n          \\ # We're cloning directly from master. Parse binlog position.\\n  [[ `cat\\\n          \\ xtrabackup_binlog_info` =~ ^(.*?)[[:space:]]+(.*?)$ ]] || exit 1\\n  rm\\\n          \\ xtrabackup_binlog_info\\n  echo \\\"CHANGE MASTER TO MASTER_LOG_FILE='${BASH_REMATCH[1]}',\\\\\\\n          \\n        MASTER_LOG_POS=${BASH_REMATCH[2]}\\\" > change_master_to.sql.in\\n\\\n          fi\\n\\n# Check if we need to complete a clone by starting replication.\\n\\\n          if [[ -f change_master_to.sql.in ]]; then\\n  echo \\\"Waiting for mysqld to\\\n          \\ be ready (accepting connections)\\\"\\n  until mysql -h 127.0.0.1 -e \\\"SELECT\\\n          \\ 1\\\"; do sleep 1; done\\n\\n  echo \\\"Initializing replication from clone\\\n          \\ position\\\"\\n  # In case of container restart, attempt this at-most-once.\\n\\\n          \\  mv change_master_to.sql.in change_master_to.sql.orig\\n  mysql -h 127.0.0.1\\\n          \\ <<EOF\\n$(<change_master_to.sql.orig),\\n  MASTER_HOST='mysql-0.mysql',\\n\\\n          \\  MASTER_USER='root',\\n  MASTER_PASSWORD='',\\n  MASTER_CONNECT_RETRY=10;\\n\\\n          START SLAVE;\\nEOF\\nfi\\n\\n# Start a server to send backups when requested\\\n          \\ by peers.\\nexec ncat --listen --keep-open --send-only --max-conns=1 3307\\\n          \\ -c \\\\\\n  \\\"xtrabackup --backup --slave-info --stream=xbstream --host=127.0.0.1\\\n          \\ --user=root\\\"\\n\"\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 100m\n            memory: 100Mi\n      volumes:\n      - name: conf\n        emptyDir: {}\n      - name: config-map\n        configMap:\n          name: mysql\n",
    "policy_id": "no-read-only-root-fs",
    "violation_text": "container \"mysql\" does not have a read-only root file system"
  },
  {
    "id": "04858",
    "manifest_path": "data/manifests/the_stack_sample/sample_2206.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: mysql\nspec:\n  selector:\n    matchLabels:\n      app: mysql\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: mysql\n    spec:\n      initContainers:\n      - name: init-mysql\n        image: mysql:5.7\n        command:\n        - bash\n        - -c\n        - \"set -ex\\n# Generate mysql server-id from pod ordinal index.\\n[[ `hostname`\\\n          \\ =~ -([0-9]+)$ ]] || exit 1\\nordinal=${BASH_REMATCH[1]}\\necho [mysqld]\\\n          \\ > /mnt/conf.d/server-id.cnf\\n# Add an offset to avoid reserved server-id=0\\\n          \\ value.\\necho server-id=$((100 + $ordinal)) >> /mnt/conf.d/server-id.cnf\\n\\\n          # Copy appropriate conf.d files from config-map to emptyDir.\\nif [[ $ordinal\\\n          \\ -eq 0 ]]; then\\n  cp /mnt/config-map/master.cnf /mnt/conf.d/\\nelse\\n \\\n          \\ cp /mnt/config-map/slave.cnf /mnt/conf.d/\\nfi\\n\"\n        volumeMounts:\n        - name: conf\n          mountPath: /mnt/conf.d\n        - name: config-map\n          mountPath: /mnt/config-map\n      - name: clone-mysql\n        image: gcr.io/google-samples/xtrabackup:1.0\n        command:\n        - bash\n        - -c\n        - 'set -ex\n\n          # Skip the clone if data already exists.\n\n          [[ -d /var/lib/mysql/mysql ]] && exit 0\n\n          # Skip the clone on master (ordinal index 0).\n\n          [[ `hostname` =~ -([0-9]+)$ ]] || exit 1\n\n          ordinal=${BASH_REMATCH[1]}\n\n          [[ $ordinal -eq 0 ]] && exit 0\n\n          # Clone data from previous peer.\n\n          ncat --recv-only mysql-$(($ordinal-1)).mysql 3307 | xbstream -x -C /var/lib/mysql\n\n          # Prepare the backup.\n\n          xtrabackup --prepare --target-dir=/var/lib/mysql\n\n          '\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n      containers:\n      - name: mysql\n        image: mysql:5.7\n        env:\n        - name: MYSQL_ALLOW_EMPTY_PASSWORD\n          value: '1'\n        ports:\n        - name: mysql\n          containerPort: 3306\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 500m\n            memory: 1Gi\n        livenessProbe:\n          exec:\n            command:\n            - mysqladmin\n            - ping\n          initialDelaySeconds: 30\n          periodSeconds: 10\n          timeoutSeconds: 5\n        readinessProbe:\n          exec:\n            command:\n            - mysql\n            - -h\n            - 127.0.0.1\n            - -e\n            - SELECT 1\n          initialDelaySeconds: 5\n          periodSeconds: 2\n          timeoutSeconds: 1\n      - name: xtrabackup\n        image: gcr.io/google-samples/xtrabackup:1.0\n        ports:\n        - name: xtrabackup\n          containerPort: 3307\n        command:\n        - bash\n        - -c\n        - \"set -ex\\ncd /var/lib/mysql\\n\\n# Determine binlog position of cloned data,\\\n          \\ if any.\\nif [[ -f xtrabackup_slave_info ]]; then\\n  # XtraBackup already\\\n          \\ generated a partial \\\"CHANGE MASTER TO\\\" query\\n  # because we're cloning\\\n          \\ from an existing slave.\\n  mv xtrabackup_slave_info change_master_to.sql.in\\n\\\n          \\  # Ignore xtrabackup_binlog_info in this case (it's useless).\\n  rm -f\\\n          \\ xtrabackup_binlog_info\\nelif [[ -f xtrabackup_binlog_info ]]; then\\n \\\n          \\ # We're cloning directly from master. Parse binlog position.\\n  [[ `cat\\\n          \\ xtrabackup_binlog_info` =~ ^(.*?)[[:space:]]+(.*?)$ ]] || exit 1\\n  rm\\\n          \\ xtrabackup_binlog_info\\n  echo \\\"CHANGE MASTER TO MASTER_LOG_FILE='${BASH_REMATCH[1]}',\\\\\\\n          \\n        MASTER_LOG_POS=${BASH_REMATCH[2]}\\\" > change_master_to.sql.in\\n\\\n          fi\\n\\n# Check if we need to complete a clone by starting replication.\\n\\\n          if [[ -f change_master_to.sql.in ]]; then\\n  echo \\\"Waiting for mysqld to\\\n          \\ be ready (accepting connections)\\\"\\n  until mysql -h 127.0.0.1 -e \\\"SELECT\\\n          \\ 1\\\"; do sleep 1; done\\n\\n  echo \\\"Initializing replication from clone\\\n          \\ position\\\"\\n  # In case of container restart, attempt this at-most-once.\\n\\\n          \\  mv change_master_to.sql.in change_master_to.sql.orig\\n  mysql -h 127.0.0.1\\\n          \\ <<EOF\\n$(<change_master_to.sql.orig),\\n  MASTER_HOST='mysql-0.mysql',\\n\\\n          \\  MASTER_USER='root',\\n  MASTER_PASSWORD='',\\n  MASTER_CONNECT_RETRY=10;\\n\\\n          START SLAVE;\\nEOF\\nfi\\n\\n# Start a server to send backups when requested\\\n          \\ by peers.\\nexec ncat --listen --keep-open --send-only --max-conns=1 3307\\\n          \\ -c \\\\\\n  \\\"xtrabackup --backup --slave-info --stream=xbstream --host=127.0.0.1\\\n          \\ --user=root\\\"\\n\"\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 100m\n            memory: 100Mi\n      volumes:\n      - name: conf\n        emptyDir: {}\n      - name: config-map\n        configMap:\n          name: mysql\n",
    "policy_id": "no-read-only-root-fs",
    "violation_text": "container \"xtrabackup\" does not have a read-only root file system"
  },
  {
    "id": "04859",
    "manifest_path": "data/manifests/the_stack_sample/sample_2206.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: mysql\nspec:\n  selector:\n    matchLabels:\n      app: mysql\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: mysql\n    spec:\n      initContainers:\n      - name: init-mysql\n        image: mysql:5.7\n        command:\n        - bash\n        - -c\n        - \"set -ex\\n# Generate mysql server-id from pod ordinal index.\\n[[ `hostname`\\\n          \\ =~ -([0-9]+)$ ]] || exit 1\\nordinal=${BASH_REMATCH[1]}\\necho [mysqld]\\\n          \\ > /mnt/conf.d/server-id.cnf\\n# Add an offset to avoid reserved server-id=0\\\n          \\ value.\\necho server-id=$((100 + $ordinal)) >> /mnt/conf.d/server-id.cnf\\n\\\n          # Copy appropriate conf.d files from config-map to emptyDir.\\nif [[ $ordinal\\\n          \\ -eq 0 ]]; then\\n  cp /mnt/config-map/master.cnf /mnt/conf.d/\\nelse\\n \\\n          \\ cp /mnt/config-map/slave.cnf /mnt/conf.d/\\nfi\\n\"\n        volumeMounts:\n        - name: conf\n          mountPath: /mnt/conf.d\n        - name: config-map\n          mountPath: /mnt/config-map\n      - name: clone-mysql\n        image: gcr.io/google-samples/xtrabackup:1.0\n        command:\n        - bash\n        - -c\n        - 'set -ex\n\n          # Skip the clone if data already exists.\n\n          [[ -d /var/lib/mysql/mysql ]] && exit 0\n\n          # Skip the clone on master (ordinal index 0).\n\n          [[ `hostname` =~ -([0-9]+)$ ]] || exit 1\n\n          ordinal=${BASH_REMATCH[1]}\n\n          [[ $ordinal -eq 0 ]] && exit 0\n\n          # Clone data from previous peer.\n\n          ncat --recv-only mysql-$(($ordinal-1)).mysql 3307 | xbstream -x -C /var/lib/mysql\n\n          # Prepare the backup.\n\n          xtrabackup --prepare --target-dir=/var/lib/mysql\n\n          '\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n      containers:\n      - name: mysql\n        image: mysql:5.7\n        env:\n        - name: MYSQL_ALLOW_EMPTY_PASSWORD\n          value: '1'\n        ports:\n        - name: mysql\n          containerPort: 3306\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 500m\n            memory: 1Gi\n        livenessProbe:\n          exec:\n            command:\n            - mysqladmin\n            - ping\n          initialDelaySeconds: 30\n          periodSeconds: 10\n          timeoutSeconds: 5\n        readinessProbe:\n          exec:\n            command:\n            - mysql\n            - -h\n            - 127.0.0.1\n            - -e\n            - SELECT 1\n          initialDelaySeconds: 5\n          periodSeconds: 2\n          timeoutSeconds: 1\n      - name: xtrabackup\n        image: gcr.io/google-samples/xtrabackup:1.0\n        ports:\n        - name: xtrabackup\n          containerPort: 3307\n        command:\n        - bash\n        - -c\n        - \"set -ex\\ncd /var/lib/mysql\\n\\n# Determine binlog position of cloned data,\\\n          \\ if any.\\nif [[ -f xtrabackup_slave_info ]]; then\\n  # XtraBackup already\\\n          \\ generated a partial \\\"CHANGE MASTER TO\\\" query\\n  # because we're cloning\\\n          \\ from an existing slave.\\n  mv xtrabackup_slave_info change_master_to.sql.in\\n\\\n          \\  # Ignore xtrabackup_binlog_info in this case (it's useless).\\n  rm -f\\\n          \\ xtrabackup_binlog_info\\nelif [[ -f xtrabackup_binlog_info ]]; then\\n \\\n          \\ # We're cloning directly from master. Parse binlog position.\\n  [[ `cat\\\n          \\ xtrabackup_binlog_info` =~ ^(.*?)[[:space:]]+(.*?)$ ]] || exit 1\\n  rm\\\n          \\ xtrabackup_binlog_info\\n  echo \\\"CHANGE MASTER TO MASTER_LOG_FILE='${BASH_REMATCH[1]}',\\\\\\\n          \\n        MASTER_LOG_POS=${BASH_REMATCH[2]}\\\" > change_master_to.sql.in\\n\\\n          fi\\n\\n# Check if we need to complete a clone by starting replication.\\n\\\n          if [[ -f change_master_to.sql.in ]]; then\\n  echo \\\"Waiting for mysqld to\\\n          \\ be ready (accepting connections)\\\"\\n  until mysql -h 127.0.0.1 -e \\\"SELECT\\\n          \\ 1\\\"; do sleep 1; done\\n\\n  echo \\\"Initializing replication from clone\\\n          \\ position\\\"\\n  # In case of container restart, attempt this at-most-once.\\n\\\n          \\  mv change_master_to.sql.in change_master_to.sql.orig\\n  mysql -h 127.0.0.1\\\n          \\ <<EOF\\n$(<change_master_to.sql.orig),\\n  MASTER_HOST='mysql-0.mysql',\\n\\\n          \\  MASTER_USER='root',\\n  MASTER_PASSWORD='',\\n  MASTER_CONNECT_RETRY=10;\\n\\\n          START SLAVE;\\nEOF\\nfi\\n\\n# Start a server to send backups when requested\\\n          \\ by peers.\\nexec ncat --listen --keep-open --send-only --max-conns=1 3307\\\n          \\ -c \\\\\\n  \\\"xtrabackup --backup --slave-info --stream=xbstream --host=127.0.0.1\\\n          \\ --user=root\\\"\\n\"\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 100m\n            memory: 100Mi\n      volumes:\n      - name: conf\n        emptyDir: {}\n      - name: config-map\n        configMap:\n          name: mysql\n",
    "policy_id": "run-as-non-root",
    "violation_text": "container \"clone-mysql\" is not set to runAsNonRoot"
  },
  {
    "id": "04860",
    "manifest_path": "data/manifests/the_stack_sample/sample_2206.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: mysql\nspec:\n  selector:\n    matchLabels:\n      app: mysql\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: mysql\n    spec:\n      initContainers:\n      - name: init-mysql\n        image: mysql:5.7\n        command:\n        - bash\n        - -c\n        - \"set -ex\\n# Generate mysql server-id from pod ordinal index.\\n[[ `hostname`\\\n          \\ =~ -([0-9]+)$ ]] || exit 1\\nordinal=${BASH_REMATCH[1]}\\necho [mysqld]\\\n          \\ > /mnt/conf.d/server-id.cnf\\n# Add an offset to avoid reserved server-id=0\\\n          \\ value.\\necho server-id=$((100 + $ordinal)) >> /mnt/conf.d/server-id.cnf\\n\\\n          # Copy appropriate conf.d files from config-map to emptyDir.\\nif [[ $ordinal\\\n          \\ -eq 0 ]]; then\\n  cp /mnt/config-map/master.cnf /mnt/conf.d/\\nelse\\n \\\n          \\ cp /mnt/config-map/slave.cnf /mnt/conf.d/\\nfi\\n\"\n        volumeMounts:\n        - name: conf\n          mountPath: /mnt/conf.d\n        - name: config-map\n          mountPath: /mnt/config-map\n      - name: clone-mysql\n        image: gcr.io/google-samples/xtrabackup:1.0\n        command:\n        - bash\n        - -c\n        - 'set -ex\n\n          # Skip the clone if data already exists.\n\n          [[ -d /var/lib/mysql/mysql ]] && exit 0\n\n          # Skip the clone on master (ordinal index 0).\n\n          [[ `hostname` =~ -([0-9]+)$ ]] || exit 1\n\n          ordinal=${BASH_REMATCH[1]}\n\n          [[ $ordinal -eq 0 ]] && exit 0\n\n          # Clone data from previous peer.\n\n          ncat --recv-only mysql-$(($ordinal-1)).mysql 3307 | xbstream -x -C /var/lib/mysql\n\n          # Prepare the backup.\n\n          xtrabackup --prepare --target-dir=/var/lib/mysql\n\n          '\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n      containers:\n      - name: mysql\n        image: mysql:5.7\n        env:\n        - name: MYSQL_ALLOW_EMPTY_PASSWORD\n          value: '1'\n        ports:\n        - name: mysql\n          containerPort: 3306\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 500m\n            memory: 1Gi\n        livenessProbe:\n          exec:\n            command:\n            - mysqladmin\n            - ping\n          initialDelaySeconds: 30\n          periodSeconds: 10\n          timeoutSeconds: 5\n        readinessProbe:\n          exec:\n            command:\n            - mysql\n            - -h\n            - 127.0.0.1\n            - -e\n            - SELECT 1\n          initialDelaySeconds: 5\n          periodSeconds: 2\n          timeoutSeconds: 1\n      - name: xtrabackup\n        image: gcr.io/google-samples/xtrabackup:1.0\n        ports:\n        - name: xtrabackup\n          containerPort: 3307\n        command:\n        - bash\n        - -c\n        - \"set -ex\\ncd /var/lib/mysql\\n\\n# Determine binlog position of cloned data,\\\n          \\ if any.\\nif [[ -f xtrabackup_slave_info ]]; then\\n  # XtraBackup already\\\n          \\ generated a partial \\\"CHANGE MASTER TO\\\" query\\n  # because we're cloning\\\n          \\ from an existing slave.\\n  mv xtrabackup_slave_info change_master_to.sql.in\\n\\\n          \\  # Ignore xtrabackup_binlog_info in this case (it's useless).\\n  rm -f\\\n          \\ xtrabackup_binlog_info\\nelif [[ -f xtrabackup_binlog_info ]]; then\\n \\\n          \\ # We're cloning directly from master. Parse binlog position.\\n  [[ `cat\\\n          \\ xtrabackup_binlog_info` =~ ^(.*?)[[:space:]]+(.*?)$ ]] || exit 1\\n  rm\\\n          \\ xtrabackup_binlog_info\\n  echo \\\"CHANGE MASTER TO MASTER_LOG_FILE='${BASH_REMATCH[1]}',\\\\\\\n          \\n        MASTER_LOG_POS=${BASH_REMATCH[2]}\\\" > change_master_to.sql.in\\n\\\n          fi\\n\\n# Check if we need to complete a clone by starting replication.\\n\\\n          if [[ -f change_master_to.sql.in ]]; then\\n  echo \\\"Waiting for mysqld to\\\n          \\ be ready (accepting connections)\\\"\\n  until mysql -h 127.0.0.1 -e \\\"SELECT\\\n          \\ 1\\\"; do sleep 1; done\\n\\n  echo \\\"Initializing replication from clone\\\n          \\ position\\\"\\n  # In case of container restart, attempt this at-most-once.\\n\\\n          \\  mv change_master_to.sql.in change_master_to.sql.orig\\n  mysql -h 127.0.0.1\\\n          \\ <<EOF\\n$(<change_master_to.sql.orig),\\n  MASTER_HOST='mysql-0.mysql',\\n\\\n          \\  MASTER_USER='root',\\n  MASTER_PASSWORD='',\\n  MASTER_CONNECT_RETRY=10;\\n\\\n          START SLAVE;\\nEOF\\nfi\\n\\n# Start a server to send backups when requested\\\n          \\ by peers.\\nexec ncat --listen --keep-open --send-only --max-conns=1 3307\\\n          \\ -c \\\\\\n  \\\"xtrabackup --backup --slave-info --stream=xbstream --host=127.0.0.1\\\n          \\ --user=root\\\"\\n\"\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 100m\n            memory: 100Mi\n      volumes:\n      - name: conf\n        emptyDir: {}\n      - name: config-map\n        configMap:\n          name: mysql\n",
    "policy_id": "run-as-non-root",
    "violation_text": "container \"init-mysql\" is not set to runAsNonRoot"
  },
  {
    "id": "04861",
    "manifest_path": "data/manifests/the_stack_sample/sample_2206.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: mysql\nspec:\n  selector:\n    matchLabels:\n      app: mysql\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: mysql\n    spec:\n      initContainers:\n      - name: init-mysql\n        image: mysql:5.7\n        command:\n        - bash\n        - -c\n        - \"set -ex\\n# Generate mysql server-id from pod ordinal index.\\n[[ `hostname`\\\n          \\ =~ -([0-9]+)$ ]] || exit 1\\nordinal=${BASH_REMATCH[1]}\\necho [mysqld]\\\n          \\ > /mnt/conf.d/server-id.cnf\\n# Add an offset to avoid reserved server-id=0\\\n          \\ value.\\necho server-id=$((100 + $ordinal)) >> /mnt/conf.d/server-id.cnf\\n\\\n          # Copy appropriate conf.d files from config-map to emptyDir.\\nif [[ $ordinal\\\n          \\ -eq 0 ]]; then\\n  cp /mnt/config-map/master.cnf /mnt/conf.d/\\nelse\\n \\\n          \\ cp /mnt/config-map/slave.cnf /mnt/conf.d/\\nfi\\n\"\n        volumeMounts:\n        - name: conf\n          mountPath: /mnt/conf.d\n        - name: config-map\n          mountPath: /mnt/config-map\n      - name: clone-mysql\n        image: gcr.io/google-samples/xtrabackup:1.0\n        command:\n        - bash\n        - -c\n        - 'set -ex\n\n          # Skip the clone if data already exists.\n\n          [[ -d /var/lib/mysql/mysql ]] && exit 0\n\n          # Skip the clone on master (ordinal index 0).\n\n          [[ `hostname` =~ -([0-9]+)$ ]] || exit 1\n\n          ordinal=${BASH_REMATCH[1]}\n\n          [[ $ordinal -eq 0 ]] && exit 0\n\n          # Clone data from previous peer.\n\n          ncat --recv-only mysql-$(($ordinal-1)).mysql 3307 | xbstream -x -C /var/lib/mysql\n\n          # Prepare the backup.\n\n          xtrabackup --prepare --target-dir=/var/lib/mysql\n\n          '\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n      containers:\n      - name: mysql\n        image: mysql:5.7\n        env:\n        - name: MYSQL_ALLOW_EMPTY_PASSWORD\n          value: '1'\n        ports:\n        - name: mysql\n          containerPort: 3306\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 500m\n            memory: 1Gi\n        livenessProbe:\n          exec:\n            command:\n            - mysqladmin\n            - ping\n          initialDelaySeconds: 30\n          periodSeconds: 10\n          timeoutSeconds: 5\n        readinessProbe:\n          exec:\n            command:\n            - mysql\n            - -h\n            - 127.0.0.1\n            - -e\n            - SELECT 1\n          initialDelaySeconds: 5\n          periodSeconds: 2\n          timeoutSeconds: 1\n      - name: xtrabackup\n        image: gcr.io/google-samples/xtrabackup:1.0\n        ports:\n        - name: xtrabackup\n          containerPort: 3307\n        command:\n        - bash\n        - -c\n        - \"set -ex\\ncd /var/lib/mysql\\n\\n# Determine binlog position of cloned data,\\\n          \\ if any.\\nif [[ -f xtrabackup_slave_info ]]; then\\n  # XtraBackup already\\\n          \\ generated a partial \\\"CHANGE MASTER TO\\\" query\\n  # because we're cloning\\\n          \\ from an existing slave.\\n  mv xtrabackup_slave_info change_master_to.sql.in\\n\\\n          \\  # Ignore xtrabackup_binlog_info in this case (it's useless).\\n  rm -f\\\n          \\ xtrabackup_binlog_info\\nelif [[ -f xtrabackup_binlog_info ]]; then\\n \\\n          \\ # We're cloning directly from master. Parse binlog position.\\n  [[ `cat\\\n          \\ xtrabackup_binlog_info` =~ ^(.*?)[[:space:]]+(.*?)$ ]] || exit 1\\n  rm\\\n          \\ xtrabackup_binlog_info\\n  echo \\\"CHANGE MASTER TO MASTER_LOG_FILE='${BASH_REMATCH[1]}',\\\\\\\n          \\n        MASTER_LOG_POS=${BASH_REMATCH[2]}\\\" > change_master_to.sql.in\\n\\\n          fi\\n\\n# Check if we need to complete a clone by starting replication.\\n\\\n          if [[ -f change_master_to.sql.in ]]; then\\n  echo \\\"Waiting for mysqld to\\\n          \\ be ready (accepting connections)\\\"\\n  until mysql -h 127.0.0.1 -e \\\"SELECT\\\n          \\ 1\\\"; do sleep 1; done\\n\\n  echo \\\"Initializing replication from clone\\\n          \\ position\\\"\\n  # In case of container restart, attempt this at-most-once.\\n\\\n          \\  mv change_master_to.sql.in change_master_to.sql.orig\\n  mysql -h 127.0.0.1\\\n          \\ <<EOF\\n$(<change_master_to.sql.orig),\\n  MASTER_HOST='mysql-0.mysql',\\n\\\n          \\  MASTER_USER='root',\\n  MASTER_PASSWORD='',\\n  MASTER_CONNECT_RETRY=10;\\n\\\n          START SLAVE;\\nEOF\\nfi\\n\\n# Start a server to send backups when requested\\\n          \\ by peers.\\nexec ncat --listen --keep-open --send-only --max-conns=1 3307\\\n          \\ -c \\\\\\n  \\\"xtrabackup --backup --slave-info --stream=xbstream --host=127.0.0.1\\\n          \\ --user=root\\\"\\n\"\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 100m\n            memory: 100Mi\n      volumes:\n      - name: conf\n        emptyDir: {}\n      - name: config-map\n        configMap:\n          name: mysql\n",
    "policy_id": "run-as-non-root",
    "violation_text": "container \"mysql\" is not set to runAsNonRoot"
  },
  {
    "id": "04862",
    "manifest_path": "data/manifests/the_stack_sample/sample_2206.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: mysql\nspec:\n  selector:\n    matchLabels:\n      app: mysql\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: mysql\n    spec:\n      initContainers:\n      - name: init-mysql\n        image: mysql:5.7\n        command:\n        - bash\n        - -c\n        - \"set -ex\\n# Generate mysql server-id from pod ordinal index.\\n[[ `hostname`\\\n          \\ =~ -([0-9]+)$ ]] || exit 1\\nordinal=${BASH_REMATCH[1]}\\necho [mysqld]\\\n          \\ > /mnt/conf.d/server-id.cnf\\n# Add an offset to avoid reserved server-id=0\\\n          \\ value.\\necho server-id=$((100 + $ordinal)) >> /mnt/conf.d/server-id.cnf\\n\\\n          # Copy appropriate conf.d files from config-map to emptyDir.\\nif [[ $ordinal\\\n          \\ -eq 0 ]]; then\\n  cp /mnt/config-map/master.cnf /mnt/conf.d/\\nelse\\n \\\n          \\ cp /mnt/config-map/slave.cnf /mnt/conf.d/\\nfi\\n\"\n        volumeMounts:\n        - name: conf\n          mountPath: /mnt/conf.d\n        - name: config-map\n          mountPath: /mnt/config-map\n      - name: clone-mysql\n        image: gcr.io/google-samples/xtrabackup:1.0\n        command:\n        - bash\n        - -c\n        - 'set -ex\n\n          # Skip the clone if data already exists.\n\n          [[ -d /var/lib/mysql/mysql ]] && exit 0\n\n          # Skip the clone on master (ordinal index 0).\n\n          [[ `hostname` =~ -([0-9]+)$ ]] || exit 1\n\n          ordinal=${BASH_REMATCH[1]}\n\n          [[ $ordinal -eq 0 ]] && exit 0\n\n          # Clone data from previous peer.\n\n          ncat --recv-only mysql-$(($ordinal-1)).mysql 3307 | xbstream -x -C /var/lib/mysql\n\n          # Prepare the backup.\n\n          xtrabackup --prepare --target-dir=/var/lib/mysql\n\n          '\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n      containers:\n      - name: mysql\n        image: mysql:5.7\n        env:\n        - name: MYSQL_ALLOW_EMPTY_PASSWORD\n          value: '1'\n        ports:\n        - name: mysql\n          containerPort: 3306\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 500m\n            memory: 1Gi\n        livenessProbe:\n          exec:\n            command:\n            - mysqladmin\n            - ping\n          initialDelaySeconds: 30\n          periodSeconds: 10\n          timeoutSeconds: 5\n        readinessProbe:\n          exec:\n            command:\n            - mysql\n            - -h\n            - 127.0.0.1\n            - -e\n            - SELECT 1\n          initialDelaySeconds: 5\n          periodSeconds: 2\n          timeoutSeconds: 1\n      - name: xtrabackup\n        image: gcr.io/google-samples/xtrabackup:1.0\n        ports:\n        - name: xtrabackup\n          containerPort: 3307\n        command:\n        - bash\n        - -c\n        - \"set -ex\\ncd /var/lib/mysql\\n\\n# Determine binlog position of cloned data,\\\n          \\ if any.\\nif [[ -f xtrabackup_slave_info ]]; then\\n  # XtraBackup already\\\n          \\ generated a partial \\\"CHANGE MASTER TO\\\" query\\n  # because we're cloning\\\n          \\ from an existing slave.\\n  mv xtrabackup_slave_info change_master_to.sql.in\\n\\\n          \\  # Ignore xtrabackup_binlog_info in this case (it's useless).\\n  rm -f\\\n          \\ xtrabackup_binlog_info\\nelif [[ -f xtrabackup_binlog_info ]]; then\\n \\\n          \\ # We're cloning directly from master. Parse binlog position.\\n  [[ `cat\\\n          \\ xtrabackup_binlog_info` =~ ^(.*?)[[:space:]]+(.*?)$ ]] || exit 1\\n  rm\\\n          \\ xtrabackup_binlog_info\\n  echo \\\"CHANGE MASTER TO MASTER_LOG_FILE='${BASH_REMATCH[1]}',\\\\\\\n          \\n        MASTER_LOG_POS=${BASH_REMATCH[2]}\\\" > change_master_to.sql.in\\n\\\n          fi\\n\\n# Check if we need to complete a clone by starting replication.\\n\\\n          if [[ -f change_master_to.sql.in ]]; then\\n  echo \\\"Waiting for mysqld to\\\n          \\ be ready (accepting connections)\\\"\\n  until mysql -h 127.0.0.1 -e \\\"SELECT\\\n          \\ 1\\\"; do sleep 1; done\\n\\n  echo \\\"Initializing replication from clone\\\n          \\ position\\\"\\n  # In case of container restart, attempt this at-most-once.\\n\\\n          \\  mv change_master_to.sql.in change_master_to.sql.orig\\n  mysql -h 127.0.0.1\\\n          \\ <<EOF\\n$(<change_master_to.sql.orig),\\n  MASTER_HOST='mysql-0.mysql',\\n\\\n          \\  MASTER_USER='root',\\n  MASTER_PASSWORD='',\\n  MASTER_CONNECT_RETRY=10;\\n\\\n          START SLAVE;\\nEOF\\nfi\\n\\n# Start a server to send backups when requested\\\n          \\ by peers.\\nexec ncat --listen --keep-open --send-only --max-conns=1 3307\\\n          \\ -c \\\\\\n  \\\"xtrabackup --backup --slave-info --stream=xbstream --host=127.0.0.1\\\n          \\ --user=root\\\"\\n\"\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 100m\n            memory: 100Mi\n      volumes:\n      - name: conf\n        emptyDir: {}\n      - name: config-map\n        configMap:\n          name: mysql\n",
    "policy_id": "run-as-non-root",
    "violation_text": "container \"xtrabackup\" is not set to runAsNonRoot"
  },
  {
    "id": "04863",
    "manifest_path": "data/manifests/the_stack_sample/sample_2206.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: mysql\nspec:\n  selector:\n    matchLabels:\n      app: mysql\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: mysql\n    spec:\n      initContainers:\n      - name: init-mysql\n        image: mysql:5.7\n        command:\n        - bash\n        - -c\n        - \"set -ex\\n# Generate mysql server-id from pod ordinal index.\\n[[ `hostname`\\\n          \\ =~ -([0-9]+)$ ]] || exit 1\\nordinal=${BASH_REMATCH[1]}\\necho [mysqld]\\\n          \\ > /mnt/conf.d/server-id.cnf\\n# Add an offset to avoid reserved server-id=0\\\n          \\ value.\\necho server-id=$((100 + $ordinal)) >> /mnt/conf.d/server-id.cnf\\n\\\n          # Copy appropriate conf.d files from config-map to emptyDir.\\nif [[ $ordinal\\\n          \\ -eq 0 ]]; then\\n  cp /mnt/config-map/master.cnf /mnt/conf.d/\\nelse\\n \\\n          \\ cp /mnt/config-map/slave.cnf /mnt/conf.d/\\nfi\\n\"\n        volumeMounts:\n        - name: conf\n          mountPath: /mnt/conf.d\n        - name: config-map\n          mountPath: /mnt/config-map\n      - name: clone-mysql\n        image: gcr.io/google-samples/xtrabackup:1.0\n        command:\n        - bash\n        - -c\n        - 'set -ex\n\n          # Skip the clone if data already exists.\n\n          [[ -d /var/lib/mysql/mysql ]] && exit 0\n\n          # Skip the clone on master (ordinal index 0).\n\n          [[ `hostname` =~ -([0-9]+)$ ]] || exit 1\n\n          ordinal=${BASH_REMATCH[1]}\n\n          [[ $ordinal -eq 0 ]] && exit 0\n\n          # Clone data from previous peer.\n\n          ncat --recv-only mysql-$(($ordinal-1)).mysql 3307 | xbstream -x -C /var/lib/mysql\n\n          # Prepare the backup.\n\n          xtrabackup --prepare --target-dir=/var/lib/mysql\n\n          '\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n      containers:\n      - name: mysql\n        image: mysql:5.7\n        env:\n        - name: MYSQL_ALLOW_EMPTY_PASSWORD\n          value: '1'\n        ports:\n        - name: mysql\n          containerPort: 3306\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 500m\n            memory: 1Gi\n        livenessProbe:\n          exec:\n            command:\n            - mysqladmin\n            - ping\n          initialDelaySeconds: 30\n          periodSeconds: 10\n          timeoutSeconds: 5\n        readinessProbe:\n          exec:\n            command:\n            - mysql\n            - -h\n            - 127.0.0.1\n            - -e\n            - SELECT 1\n          initialDelaySeconds: 5\n          periodSeconds: 2\n          timeoutSeconds: 1\n      - name: xtrabackup\n        image: gcr.io/google-samples/xtrabackup:1.0\n        ports:\n        - name: xtrabackup\n          containerPort: 3307\n        command:\n        - bash\n        - -c\n        - \"set -ex\\ncd /var/lib/mysql\\n\\n# Determine binlog position of cloned data,\\\n          \\ if any.\\nif [[ -f xtrabackup_slave_info ]]; then\\n  # XtraBackup already\\\n          \\ generated a partial \\\"CHANGE MASTER TO\\\" query\\n  # because we're cloning\\\n          \\ from an existing slave.\\n  mv xtrabackup_slave_info change_master_to.sql.in\\n\\\n          \\  # Ignore xtrabackup_binlog_info in this case (it's useless).\\n  rm -f\\\n          \\ xtrabackup_binlog_info\\nelif [[ -f xtrabackup_binlog_info ]]; then\\n \\\n          \\ # We're cloning directly from master. Parse binlog position.\\n  [[ `cat\\\n          \\ xtrabackup_binlog_info` =~ ^(.*?)[[:space:]]+(.*?)$ ]] || exit 1\\n  rm\\\n          \\ xtrabackup_binlog_info\\n  echo \\\"CHANGE MASTER TO MASTER_LOG_FILE='${BASH_REMATCH[1]}',\\\\\\\n          \\n        MASTER_LOG_POS=${BASH_REMATCH[2]}\\\" > change_master_to.sql.in\\n\\\n          fi\\n\\n# Check if we need to complete a clone by starting replication.\\n\\\n          if [[ -f change_master_to.sql.in ]]; then\\n  echo \\\"Waiting for mysqld to\\\n          \\ be ready (accepting connections)\\\"\\n  until mysql -h 127.0.0.1 -e \\\"SELECT\\\n          \\ 1\\\"; do sleep 1; done\\n\\n  echo \\\"Initializing replication from clone\\\n          \\ position\\\"\\n  # In case of container restart, attempt this at-most-once.\\n\\\n          \\  mv change_master_to.sql.in change_master_to.sql.orig\\n  mysql -h 127.0.0.1\\\n          \\ <<EOF\\n$(<change_master_to.sql.orig),\\n  MASTER_HOST='mysql-0.mysql',\\n\\\n          \\  MASTER_USER='root',\\n  MASTER_PASSWORD='',\\n  MASTER_CONNECT_RETRY=10;\\n\\\n          START SLAVE;\\nEOF\\nfi\\n\\n# Start a server to send backups when requested\\\n          \\ by peers.\\nexec ncat --listen --keep-open --send-only --max-conns=1 3307\\\n          \\ -c \\\\\\n  \\\"xtrabackup --backup --slave-info --stream=xbstream --host=127.0.0.1\\\n          \\ --user=root\\\"\\n\"\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 100m\n            memory: 100Mi\n      volumes:\n      - name: conf\n        emptyDir: {}\n      - name: config-map\n        configMap:\n          name: mysql\n",
    "policy_id": "unset-cpu-requirements",
    "violation_text": "container \"clone-mysql\" has cpu request 0"
  },
  {
    "id": "04864",
    "manifest_path": "data/manifests/the_stack_sample/sample_2206.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: mysql\nspec:\n  selector:\n    matchLabels:\n      app: mysql\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: mysql\n    spec:\n      initContainers:\n      - name: init-mysql\n        image: mysql:5.7\n        command:\n        - bash\n        - -c\n        - \"set -ex\\n# Generate mysql server-id from pod ordinal index.\\n[[ `hostname`\\\n          \\ =~ -([0-9]+)$ ]] || exit 1\\nordinal=${BASH_REMATCH[1]}\\necho [mysqld]\\\n          \\ > /mnt/conf.d/server-id.cnf\\n# Add an offset to avoid reserved server-id=0\\\n          \\ value.\\necho server-id=$((100 + $ordinal)) >> /mnt/conf.d/server-id.cnf\\n\\\n          # Copy appropriate conf.d files from config-map to emptyDir.\\nif [[ $ordinal\\\n          \\ -eq 0 ]]; then\\n  cp /mnt/config-map/master.cnf /mnt/conf.d/\\nelse\\n \\\n          \\ cp /mnt/config-map/slave.cnf /mnt/conf.d/\\nfi\\n\"\n        volumeMounts:\n        - name: conf\n          mountPath: /mnt/conf.d\n        - name: config-map\n          mountPath: /mnt/config-map\n      - name: clone-mysql\n        image: gcr.io/google-samples/xtrabackup:1.0\n        command:\n        - bash\n        - -c\n        - 'set -ex\n\n          # Skip the clone if data already exists.\n\n          [[ -d /var/lib/mysql/mysql ]] && exit 0\n\n          # Skip the clone on master (ordinal index 0).\n\n          [[ `hostname` =~ -([0-9]+)$ ]] || exit 1\n\n          ordinal=${BASH_REMATCH[1]}\n\n          [[ $ordinal -eq 0 ]] && exit 0\n\n          # Clone data from previous peer.\n\n          ncat --recv-only mysql-$(($ordinal-1)).mysql 3307 | xbstream -x -C /var/lib/mysql\n\n          # Prepare the backup.\n\n          xtrabackup --prepare --target-dir=/var/lib/mysql\n\n          '\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n      containers:\n      - name: mysql\n        image: mysql:5.7\n        env:\n        - name: MYSQL_ALLOW_EMPTY_PASSWORD\n          value: '1'\n        ports:\n        - name: mysql\n          containerPort: 3306\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 500m\n            memory: 1Gi\n        livenessProbe:\n          exec:\n            command:\n            - mysqladmin\n            - ping\n          initialDelaySeconds: 30\n          periodSeconds: 10\n          timeoutSeconds: 5\n        readinessProbe:\n          exec:\n            command:\n            - mysql\n            - -h\n            - 127.0.0.1\n            - -e\n            - SELECT 1\n          initialDelaySeconds: 5\n          periodSeconds: 2\n          timeoutSeconds: 1\n      - name: xtrabackup\n        image: gcr.io/google-samples/xtrabackup:1.0\n        ports:\n        - name: xtrabackup\n          containerPort: 3307\n        command:\n        - bash\n        - -c\n        - \"set -ex\\ncd /var/lib/mysql\\n\\n# Determine binlog position of cloned data,\\\n          \\ if any.\\nif [[ -f xtrabackup_slave_info ]]; then\\n  # XtraBackup already\\\n          \\ generated a partial \\\"CHANGE MASTER TO\\\" query\\n  # because we're cloning\\\n          \\ from an existing slave.\\n  mv xtrabackup_slave_info change_master_to.sql.in\\n\\\n          \\  # Ignore xtrabackup_binlog_info in this case (it's useless).\\n  rm -f\\\n          \\ xtrabackup_binlog_info\\nelif [[ -f xtrabackup_binlog_info ]]; then\\n \\\n          \\ # We're cloning directly from master. Parse binlog position.\\n  [[ `cat\\\n          \\ xtrabackup_binlog_info` =~ ^(.*?)[[:space:]]+(.*?)$ ]] || exit 1\\n  rm\\\n          \\ xtrabackup_binlog_info\\n  echo \\\"CHANGE MASTER TO MASTER_LOG_FILE='${BASH_REMATCH[1]}',\\\\\\\n          \\n        MASTER_LOG_POS=${BASH_REMATCH[2]}\\\" > change_master_to.sql.in\\n\\\n          fi\\n\\n# Check if we need to complete a clone by starting replication.\\n\\\n          if [[ -f change_master_to.sql.in ]]; then\\n  echo \\\"Waiting for mysqld to\\\n          \\ be ready (accepting connections)\\\"\\n  until mysql -h 127.0.0.1 -e \\\"SELECT\\\n          \\ 1\\\"; do sleep 1; done\\n\\n  echo \\\"Initializing replication from clone\\\n          \\ position\\\"\\n  # In case of container restart, attempt this at-most-once.\\n\\\n          \\  mv change_master_to.sql.in change_master_to.sql.orig\\n  mysql -h 127.0.0.1\\\n          \\ <<EOF\\n$(<change_master_to.sql.orig),\\n  MASTER_HOST='mysql-0.mysql',\\n\\\n          \\  MASTER_USER='root',\\n  MASTER_PASSWORD='',\\n  MASTER_CONNECT_RETRY=10;\\n\\\n          START SLAVE;\\nEOF\\nfi\\n\\n# Start a server to send backups when requested\\\n          \\ by peers.\\nexec ncat --listen --keep-open --send-only --max-conns=1 3307\\\n          \\ -c \\\\\\n  \\\"xtrabackup --backup --slave-info --stream=xbstream --host=127.0.0.1\\\n          \\ --user=root\\\"\\n\"\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 100m\n            memory: 100Mi\n      volumes:\n      - name: conf\n        emptyDir: {}\n      - name: config-map\n        configMap:\n          name: mysql\n",
    "policy_id": "unset-cpu-requirements",
    "violation_text": "container \"init-mysql\" has cpu request 0"
  },
  {
    "id": "04865",
    "manifest_path": "data/manifests/the_stack_sample/sample_2206.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: mysql\nspec:\n  selector:\n    matchLabels:\n      app: mysql\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: mysql\n    spec:\n      initContainers:\n      - name: init-mysql\n        image: mysql:5.7\n        command:\n        - bash\n        - -c\n        - \"set -ex\\n# Generate mysql server-id from pod ordinal index.\\n[[ `hostname`\\\n          \\ =~ -([0-9]+)$ ]] || exit 1\\nordinal=${BASH_REMATCH[1]}\\necho [mysqld]\\\n          \\ > /mnt/conf.d/server-id.cnf\\n# Add an offset to avoid reserved server-id=0\\\n          \\ value.\\necho server-id=$((100 + $ordinal)) >> /mnt/conf.d/server-id.cnf\\n\\\n          # Copy appropriate conf.d files from config-map to emptyDir.\\nif [[ $ordinal\\\n          \\ -eq 0 ]]; then\\n  cp /mnt/config-map/master.cnf /mnt/conf.d/\\nelse\\n \\\n          \\ cp /mnt/config-map/slave.cnf /mnt/conf.d/\\nfi\\n\"\n        volumeMounts:\n        - name: conf\n          mountPath: /mnt/conf.d\n        - name: config-map\n          mountPath: /mnt/config-map\n      - name: clone-mysql\n        image: gcr.io/google-samples/xtrabackup:1.0\n        command:\n        - bash\n        - -c\n        - 'set -ex\n\n          # Skip the clone if data already exists.\n\n          [[ -d /var/lib/mysql/mysql ]] && exit 0\n\n          # Skip the clone on master (ordinal index 0).\n\n          [[ `hostname` =~ -([0-9]+)$ ]] || exit 1\n\n          ordinal=${BASH_REMATCH[1]}\n\n          [[ $ordinal -eq 0 ]] && exit 0\n\n          # Clone data from previous peer.\n\n          ncat --recv-only mysql-$(($ordinal-1)).mysql 3307 | xbstream -x -C /var/lib/mysql\n\n          # Prepare the backup.\n\n          xtrabackup --prepare --target-dir=/var/lib/mysql\n\n          '\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n      containers:\n      - name: mysql\n        image: mysql:5.7\n        env:\n        - name: MYSQL_ALLOW_EMPTY_PASSWORD\n          value: '1'\n        ports:\n        - name: mysql\n          containerPort: 3306\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 500m\n            memory: 1Gi\n        livenessProbe:\n          exec:\n            command:\n            - mysqladmin\n            - ping\n          initialDelaySeconds: 30\n          periodSeconds: 10\n          timeoutSeconds: 5\n        readinessProbe:\n          exec:\n            command:\n            - mysql\n            - -h\n            - 127.0.0.1\n            - -e\n            - SELECT 1\n          initialDelaySeconds: 5\n          periodSeconds: 2\n          timeoutSeconds: 1\n      - name: xtrabackup\n        image: gcr.io/google-samples/xtrabackup:1.0\n        ports:\n        - name: xtrabackup\n          containerPort: 3307\n        command:\n        - bash\n        - -c\n        - \"set -ex\\ncd /var/lib/mysql\\n\\n# Determine binlog position of cloned data,\\\n          \\ if any.\\nif [[ -f xtrabackup_slave_info ]]; then\\n  # XtraBackup already\\\n          \\ generated a partial \\\"CHANGE MASTER TO\\\" query\\n  # because we're cloning\\\n          \\ from an existing slave.\\n  mv xtrabackup_slave_info change_master_to.sql.in\\n\\\n          \\  # Ignore xtrabackup_binlog_info in this case (it's useless).\\n  rm -f\\\n          \\ xtrabackup_binlog_info\\nelif [[ -f xtrabackup_binlog_info ]]; then\\n \\\n          \\ # We're cloning directly from master. Parse binlog position.\\n  [[ `cat\\\n          \\ xtrabackup_binlog_info` =~ ^(.*?)[[:space:]]+(.*?)$ ]] || exit 1\\n  rm\\\n          \\ xtrabackup_binlog_info\\n  echo \\\"CHANGE MASTER TO MASTER_LOG_FILE='${BASH_REMATCH[1]}',\\\\\\\n          \\n        MASTER_LOG_POS=${BASH_REMATCH[2]}\\\" > change_master_to.sql.in\\n\\\n          fi\\n\\n# Check if we need to complete a clone by starting replication.\\n\\\n          if [[ -f change_master_to.sql.in ]]; then\\n  echo \\\"Waiting for mysqld to\\\n          \\ be ready (accepting connections)\\\"\\n  until mysql -h 127.0.0.1 -e \\\"SELECT\\\n          \\ 1\\\"; do sleep 1; done\\n\\n  echo \\\"Initializing replication from clone\\\n          \\ position\\\"\\n  # In case of container restart, attempt this at-most-once.\\n\\\n          \\  mv change_master_to.sql.in change_master_to.sql.orig\\n  mysql -h 127.0.0.1\\\n          \\ <<EOF\\n$(<change_master_to.sql.orig),\\n  MASTER_HOST='mysql-0.mysql',\\n\\\n          \\  MASTER_USER='root',\\n  MASTER_PASSWORD='',\\n  MASTER_CONNECT_RETRY=10;\\n\\\n          START SLAVE;\\nEOF\\nfi\\n\\n# Start a server to send backups when requested\\\n          \\ by peers.\\nexec ncat --listen --keep-open --send-only --max-conns=1 3307\\\n          \\ -c \\\\\\n  \\\"xtrabackup --backup --slave-info --stream=xbstream --host=127.0.0.1\\\n          \\ --user=root\\\"\\n\"\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 100m\n            memory: 100Mi\n      volumes:\n      - name: conf\n        emptyDir: {}\n      - name: config-map\n        configMap:\n          name: mysql\n",
    "policy_id": "unset-memory-requirements",
    "violation_text": "container \"clone-mysql\" has memory limit 0"
  },
  {
    "id": "04866",
    "manifest_path": "data/manifests/the_stack_sample/sample_2206.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: mysql\nspec:\n  selector:\n    matchLabels:\n      app: mysql\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: mysql\n    spec:\n      initContainers:\n      - name: init-mysql\n        image: mysql:5.7\n        command:\n        - bash\n        - -c\n        - \"set -ex\\n# Generate mysql server-id from pod ordinal index.\\n[[ `hostname`\\\n          \\ =~ -([0-9]+)$ ]] || exit 1\\nordinal=${BASH_REMATCH[1]}\\necho [mysqld]\\\n          \\ > /mnt/conf.d/server-id.cnf\\n# Add an offset to avoid reserved server-id=0\\\n          \\ value.\\necho server-id=$((100 + $ordinal)) >> /mnt/conf.d/server-id.cnf\\n\\\n          # Copy appropriate conf.d files from config-map to emptyDir.\\nif [[ $ordinal\\\n          \\ -eq 0 ]]; then\\n  cp /mnt/config-map/master.cnf /mnt/conf.d/\\nelse\\n \\\n          \\ cp /mnt/config-map/slave.cnf /mnt/conf.d/\\nfi\\n\"\n        volumeMounts:\n        - name: conf\n          mountPath: /mnt/conf.d\n        - name: config-map\n          mountPath: /mnt/config-map\n      - name: clone-mysql\n        image: gcr.io/google-samples/xtrabackup:1.0\n        command:\n        - bash\n        - -c\n        - 'set -ex\n\n          # Skip the clone if data already exists.\n\n          [[ -d /var/lib/mysql/mysql ]] && exit 0\n\n          # Skip the clone on master (ordinal index 0).\n\n          [[ `hostname` =~ -([0-9]+)$ ]] || exit 1\n\n          ordinal=${BASH_REMATCH[1]}\n\n          [[ $ordinal -eq 0 ]] && exit 0\n\n          # Clone data from previous peer.\n\n          ncat --recv-only mysql-$(($ordinal-1)).mysql 3307 | xbstream -x -C /var/lib/mysql\n\n          # Prepare the backup.\n\n          xtrabackup --prepare --target-dir=/var/lib/mysql\n\n          '\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n      containers:\n      - name: mysql\n        image: mysql:5.7\n        env:\n        - name: MYSQL_ALLOW_EMPTY_PASSWORD\n          value: '1'\n        ports:\n        - name: mysql\n          containerPort: 3306\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 500m\n            memory: 1Gi\n        livenessProbe:\n          exec:\n            command:\n            - mysqladmin\n            - ping\n          initialDelaySeconds: 30\n          periodSeconds: 10\n          timeoutSeconds: 5\n        readinessProbe:\n          exec:\n            command:\n            - mysql\n            - -h\n            - 127.0.0.1\n            - -e\n            - SELECT 1\n          initialDelaySeconds: 5\n          periodSeconds: 2\n          timeoutSeconds: 1\n      - name: xtrabackup\n        image: gcr.io/google-samples/xtrabackup:1.0\n        ports:\n        - name: xtrabackup\n          containerPort: 3307\n        command:\n        - bash\n        - -c\n        - \"set -ex\\ncd /var/lib/mysql\\n\\n# Determine binlog position of cloned data,\\\n          \\ if any.\\nif [[ -f xtrabackup_slave_info ]]; then\\n  # XtraBackup already\\\n          \\ generated a partial \\\"CHANGE MASTER TO\\\" query\\n  # because we're cloning\\\n          \\ from an existing slave.\\n  mv xtrabackup_slave_info change_master_to.sql.in\\n\\\n          \\  # Ignore xtrabackup_binlog_info in this case (it's useless).\\n  rm -f\\\n          \\ xtrabackup_binlog_info\\nelif [[ -f xtrabackup_binlog_info ]]; then\\n \\\n          \\ # We're cloning directly from master. Parse binlog position.\\n  [[ `cat\\\n          \\ xtrabackup_binlog_info` =~ ^(.*?)[[:space:]]+(.*?)$ ]] || exit 1\\n  rm\\\n          \\ xtrabackup_binlog_info\\n  echo \\\"CHANGE MASTER TO MASTER_LOG_FILE='${BASH_REMATCH[1]}',\\\\\\\n          \\n        MASTER_LOG_POS=${BASH_REMATCH[2]}\\\" > change_master_to.sql.in\\n\\\n          fi\\n\\n# Check if we need to complete a clone by starting replication.\\n\\\n          if [[ -f change_master_to.sql.in ]]; then\\n  echo \\\"Waiting for mysqld to\\\n          \\ be ready (accepting connections)\\\"\\n  until mysql -h 127.0.0.1 -e \\\"SELECT\\\n          \\ 1\\\"; do sleep 1; done\\n\\n  echo \\\"Initializing replication from clone\\\n          \\ position\\\"\\n  # In case of container restart, attempt this at-most-once.\\n\\\n          \\  mv change_master_to.sql.in change_master_to.sql.orig\\n  mysql -h 127.0.0.1\\\n          \\ <<EOF\\n$(<change_master_to.sql.orig),\\n  MASTER_HOST='mysql-0.mysql',\\n\\\n          \\  MASTER_USER='root',\\n  MASTER_PASSWORD='',\\n  MASTER_CONNECT_RETRY=10;\\n\\\n          START SLAVE;\\nEOF\\nfi\\n\\n# Start a server to send backups when requested\\\n          \\ by peers.\\nexec ncat --listen --keep-open --send-only --max-conns=1 3307\\\n          \\ -c \\\\\\n  \\\"xtrabackup --backup --slave-info --stream=xbstream --host=127.0.0.1\\\n          \\ --user=root\\\"\\n\"\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 100m\n            memory: 100Mi\n      volumes:\n      - name: conf\n        emptyDir: {}\n      - name: config-map\n        configMap:\n          name: mysql\n",
    "policy_id": "unset-memory-requirements",
    "violation_text": "container \"init-mysql\" has memory limit 0"
  },
  {
    "id": "04867",
    "manifest_path": "data/manifests/the_stack_sample/sample_2206.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: mysql\nspec:\n  selector:\n    matchLabels:\n      app: mysql\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: mysql\n    spec:\n      initContainers:\n      - name: init-mysql\n        image: mysql:5.7\n        command:\n        - bash\n        - -c\n        - \"set -ex\\n# Generate mysql server-id from pod ordinal index.\\n[[ `hostname`\\\n          \\ =~ -([0-9]+)$ ]] || exit 1\\nordinal=${BASH_REMATCH[1]}\\necho [mysqld]\\\n          \\ > /mnt/conf.d/server-id.cnf\\n# Add an offset to avoid reserved server-id=0\\\n          \\ value.\\necho server-id=$((100 + $ordinal)) >> /mnt/conf.d/server-id.cnf\\n\\\n          # Copy appropriate conf.d files from config-map to emptyDir.\\nif [[ $ordinal\\\n          \\ -eq 0 ]]; then\\n  cp /mnt/config-map/master.cnf /mnt/conf.d/\\nelse\\n \\\n          \\ cp /mnt/config-map/slave.cnf /mnt/conf.d/\\nfi\\n\"\n        volumeMounts:\n        - name: conf\n          mountPath: /mnt/conf.d\n        - name: config-map\n          mountPath: /mnt/config-map\n      - name: clone-mysql\n        image: gcr.io/google-samples/xtrabackup:1.0\n        command:\n        - bash\n        - -c\n        - 'set -ex\n\n          # Skip the clone if data already exists.\n\n          [[ -d /var/lib/mysql/mysql ]] && exit 0\n\n          # Skip the clone on master (ordinal index 0).\n\n          [[ `hostname` =~ -([0-9]+)$ ]] || exit 1\n\n          ordinal=${BASH_REMATCH[1]}\n\n          [[ $ordinal -eq 0 ]] && exit 0\n\n          # Clone data from previous peer.\n\n          ncat --recv-only mysql-$(($ordinal-1)).mysql 3307 | xbstream -x -C /var/lib/mysql\n\n          # Prepare the backup.\n\n          xtrabackup --prepare --target-dir=/var/lib/mysql\n\n          '\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n      containers:\n      - name: mysql\n        image: mysql:5.7\n        env:\n        - name: MYSQL_ALLOW_EMPTY_PASSWORD\n          value: '1'\n        ports:\n        - name: mysql\n          containerPort: 3306\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 500m\n            memory: 1Gi\n        livenessProbe:\n          exec:\n            command:\n            - mysqladmin\n            - ping\n          initialDelaySeconds: 30\n          periodSeconds: 10\n          timeoutSeconds: 5\n        readinessProbe:\n          exec:\n            command:\n            - mysql\n            - -h\n            - 127.0.0.1\n            - -e\n            - SELECT 1\n          initialDelaySeconds: 5\n          periodSeconds: 2\n          timeoutSeconds: 1\n      - name: xtrabackup\n        image: gcr.io/google-samples/xtrabackup:1.0\n        ports:\n        - name: xtrabackup\n          containerPort: 3307\n        command:\n        - bash\n        - -c\n        - \"set -ex\\ncd /var/lib/mysql\\n\\n# Determine binlog position of cloned data,\\\n          \\ if any.\\nif [[ -f xtrabackup_slave_info ]]; then\\n  # XtraBackup already\\\n          \\ generated a partial \\\"CHANGE MASTER TO\\\" query\\n  # because we're cloning\\\n          \\ from an existing slave.\\n  mv xtrabackup_slave_info change_master_to.sql.in\\n\\\n          \\  # Ignore xtrabackup_binlog_info in this case (it's useless).\\n  rm -f\\\n          \\ xtrabackup_binlog_info\\nelif [[ -f xtrabackup_binlog_info ]]; then\\n \\\n          \\ # We're cloning directly from master. Parse binlog position.\\n  [[ `cat\\\n          \\ xtrabackup_binlog_info` =~ ^(.*?)[[:space:]]+(.*?)$ ]] || exit 1\\n  rm\\\n          \\ xtrabackup_binlog_info\\n  echo \\\"CHANGE MASTER TO MASTER_LOG_FILE='${BASH_REMATCH[1]}',\\\\\\\n          \\n        MASTER_LOG_POS=${BASH_REMATCH[2]}\\\" > change_master_to.sql.in\\n\\\n          fi\\n\\n# Check if we need to complete a clone by starting replication.\\n\\\n          if [[ -f change_master_to.sql.in ]]; then\\n  echo \\\"Waiting for mysqld to\\\n          \\ be ready (accepting connections)\\\"\\n  until mysql -h 127.0.0.1 -e \\\"SELECT\\\n          \\ 1\\\"; do sleep 1; done\\n\\n  echo \\\"Initializing replication from clone\\\n          \\ position\\\"\\n  # In case of container restart, attempt this at-most-once.\\n\\\n          \\  mv change_master_to.sql.in change_master_to.sql.orig\\n  mysql -h 127.0.0.1\\\n          \\ <<EOF\\n$(<change_master_to.sql.orig),\\n  MASTER_HOST='mysql-0.mysql',\\n\\\n          \\  MASTER_USER='root',\\n  MASTER_PASSWORD='',\\n  MASTER_CONNECT_RETRY=10;\\n\\\n          START SLAVE;\\nEOF\\nfi\\n\\n# Start a server to send backups when requested\\\n          \\ by peers.\\nexec ncat --listen --keep-open --send-only --max-conns=1 3307\\\n          \\ -c \\\\\\n  \\\"xtrabackup --backup --slave-info --stream=xbstream --host=127.0.0.1\\\n          \\ --user=root\\\"\\n\"\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 100m\n            memory: 100Mi\n      volumes:\n      - name: conf\n        emptyDir: {}\n      - name: config-map\n        configMap:\n          name: mysql\n",
    "policy_id": "unset-memory-requirements",
    "violation_text": "container \"mysql\" has memory limit 0"
  },
  {
    "id": "04868",
    "manifest_path": "data/manifests/the_stack_sample/sample_2206.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: mysql\nspec:\n  selector:\n    matchLabels:\n      app: mysql\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: mysql\n    spec:\n      initContainers:\n      - name: init-mysql\n        image: mysql:5.7\n        command:\n        - bash\n        - -c\n        - \"set -ex\\n# Generate mysql server-id from pod ordinal index.\\n[[ `hostname`\\\n          \\ =~ -([0-9]+)$ ]] || exit 1\\nordinal=${BASH_REMATCH[1]}\\necho [mysqld]\\\n          \\ > /mnt/conf.d/server-id.cnf\\n# Add an offset to avoid reserved server-id=0\\\n          \\ value.\\necho server-id=$((100 + $ordinal)) >> /mnt/conf.d/server-id.cnf\\n\\\n          # Copy appropriate conf.d files from config-map to emptyDir.\\nif [[ $ordinal\\\n          \\ -eq 0 ]]; then\\n  cp /mnt/config-map/master.cnf /mnt/conf.d/\\nelse\\n \\\n          \\ cp /mnt/config-map/slave.cnf /mnt/conf.d/\\nfi\\n\"\n        volumeMounts:\n        - name: conf\n          mountPath: /mnt/conf.d\n        - name: config-map\n          mountPath: /mnt/config-map\n      - name: clone-mysql\n        image: gcr.io/google-samples/xtrabackup:1.0\n        command:\n        - bash\n        - -c\n        - 'set -ex\n\n          # Skip the clone if data already exists.\n\n          [[ -d /var/lib/mysql/mysql ]] && exit 0\n\n          # Skip the clone on master (ordinal index 0).\n\n          [[ `hostname` =~ -([0-9]+)$ ]] || exit 1\n\n          ordinal=${BASH_REMATCH[1]}\n\n          [[ $ordinal -eq 0 ]] && exit 0\n\n          # Clone data from previous peer.\n\n          ncat --recv-only mysql-$(($ordinal-1)).mysql 3307 | xbstream -x -C /var/lib/mysql\n\n          # Prepare the backup.\n\n          xtrabackup --prepare --target-dir=/var/lib/mysql\n\n          '\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n      containers:\n      - name: mysql\n        image: mysql:5.7\n        env:\n        - name: MYSQL_ALLOW_EMPTY_PASSWORD\n          value: '1'\n        ports:\n        - name: mysql\n          containerPort: 3306\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 500m\n            memory: 1Gi\n        livenessProbe:\n          exec:\n            command:\n            - mysqladmin\n            - ping\n          initialDelaySeconds: 30\n          periodSeconds: 10\n          timeoutSeconds: 5\n        readinessProbe:\n          exec:\n            command:\n            - mysql\n            - -h\n            - 127.0.0.1\n            - -e\n            - SELECT 1\n          initialDelaySeconds: 5\n          periodSeconds: 2\n          timeoutSeconds: 1\n      - name: xtrabackup\n        image: gcr.io/google-samples/xtrabackup:1.0\n        ports:\n        - name: xtrabackup\n          containerPort: 3307\n        command:\n        - bash\n        - -c\n        - \"set -ex\\ncd /var/lib/mysql\\n\\n# Determine binlog position of cloned data,\\\n          \\ if any.\\nif [[ -f xtrabackup_slave_info ]]; then\\n  # XtraBackup already\\\n          \\ generated a partial \\\"CHANGE MASTER TO\\\" query\\n  # because we're cloning\\\n          \\ from an existing slave.\\n  mv xtrabackup_slave_info change_master_to.sql.in\\n\\\n          \\  # Ignore xtrabackup_binlog_info in this case (it's useless).\\n  rm -f\\\n          \\ xtrabackup_binlog_info\\nelif [[ -f xtrabackup_binlog_info ]]; then\\n \\\n          \\ # We're cloning directly from master. Parse binlog position.\\n  [[ `cat\\\n          \\ xtrabackup_binlog_info` =~ ^(.*?)[[:space:]]+(.*?)$ ]] || exit 1\\n  rm\\\n          \\ xtrabackup_binlog_info\\n  echo \\\"CHANGE MASTER TO MASTER_LOG_FILE='${BASH_REMATCH[1]}',\\\\\\\n          \\n        MASTER_LOG_POS=${BASH_REMATCH[2]}\\\" > change_master_to.sql.in\\n\\\n          fi\\n\\n# Check if we need to complete a clone by starting replication.\\n\\\n          if [[ -f change_master_to.sql.in ]]; then\\n  echo \\\"Waiting for mysqld to\\\n          \\ be ready (accepting connections)\\\"\\n  until mysql -h 127.0.0.1 -e \\\"SELECT\\\n          \\ 1\\\"; do sleep 1; done\\n\\n  echo \\\"Initializing replication from clone\\\n          \\ position\\\"\\n  # In case of container restart, attempt this at-most-once.\\n\\\n          \\  mv change_master_to.sql.in change_master_to.sql.orig\\n  mysql -h 127.0.0.1\\\n          \\ <<EOF\\n$(<change_master_to.sql.orig),\\n  MASTER_HOST='mysql-0.mysql',\\n\\\n          \\  MASTER_USER='root',\\n  MASTER_PASSWORD='',\\n  MASTER_CONNECT_RETRY=10;\\n\\\n          START SLAVE;\\nEOF\\nfi\\n\\n# Start a server to send backups when requested\\\n          \\ by peers.\\nexec ncat --listen --keep-open --send-only --max-conns=1 3307\\\n          \\ -c \\\\\\n  \\\"xtrabackup --backup --slave-info --stream=xbstream --host=127.0.0.1\\\n          \\ --user=root\\\"\\n\"\n        volumeMounts:\n        - name: data\n          mountPath: /var/lib/mysql\n          subPath: mysql\n        - name: conf\n          mountPath: /etc/mysql/conf.d\n        resources:\n          requests:\n            cpu: 100m\n            memory: 100Mi\n      volumes:\n      - name: conf\n        emptyDir: {}\n      - name: config-map\n        configMap:\n          name: mysql\n",
    "policy_id": "unset-memory-requirements",
    "violation_text": "container \"xtrabackup\" has memory limit 0"
  },
  {
    "id": "04869",
    "manifest_path": "data/manifests/the_stack_sample/sample_2209.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: discord-voice-log-bot-deployment\n  labels:\n    app: discord-voice-log-bot\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: discord-voice-log-bot\n  template:\n    metadata:\n      labels:\n        app: discord-voice-log-bot\n    spec:\n      containers:\n      - name: discord-voice-log-bot\n        image: quay.io/satackey/discord-voice-log-bot:latest\n        volumeMounts:\n        - name: bot-config\n          mountPath: /app/configs\n          readOnly: true\n      volumes:\n      - name: bot-config\n        secret:\n          secretName: discord-voice-log-bot-secret\n          items:\n          - key: config\n            path: config.ini\n",
    "policy_id": "latest-tag",
    "violation_text": "The container \"discord-voice-log-bot\" is using an invalid container image, \"quay.io/satackey/discord-voice-log-bot:latest\". Please use images that are not blocked by the `BlockList` criteria : [\".*:(latest)$\" \"^[^:]*$\" \"(.*/[^:]+)$\"]"
  },
  {
    "id": "04870",
    "manifest_path": "data/manifests/the_stack_sample/sample_2209.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: discord-voice-log-bot-deployment\n  labels:\n    app: discord-voice-log-bot\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: discord-voice-log-bot\n  template:\n    metadata:\n      labels:\n        app: discord-voice-log-bot\n    spec:\n      containers:\n      - name: discord-voice-log-bot\n        image: quay.io/satackey/discord-voice-log-bot:latest\n        volumeMounts:\n        - name: bot-config\n          mountPath: /app/configs\n          readOnly: true\n      volumes:\n      - name: bot-config\n        secret:\n          secretName: discord-voice-log-bot-secret\n          items:\n          - key: config\n            path: config.ini\n",
    "policy_id": "no-read-only-root-fs",
    "violation_text": "container \"discord-voice-log-bot\" does not have a read-only root file system"
  },
  {
    "id": "04871",
    "manifest_path": "data/manifests/the_stack_sample/sample_2209.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: discord-voice-log-bot-deployment\n  labels:\n    app: discord-voice-log-bot\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: discord-voice-log-bot\n  template:\n    metadata:\n      labels:\n        app: discord-voice-log-bot\n    spec:\n      containers:\n      - name: discord-voice-log-bot\n        image: quay.io/satackey/discord-voice-log-bot:latest\n        volumeMounts:\n        - name: bot-config\n          mountPath: /app/configs\n          readOnly: true\n      volumes:\n      - name: bot-config\n        secret:\n          secretName: discord-voice-log-bot-secret\n          items:\n          - key: config\n            path: config.ini\n",
    "policy_id": "run-as-non-root",
    "violation_text": "container \"discord-voice-log-bot\" is not set to runAsNonRoot"
  },
  {
    "id": "04872",
    "manifest_path": "data/manifests/the_stack_sample/sample_2209.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: discord-voice-log-bot-deployment\n  labels:\n    app: discord-voice-log-bot\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: discord-voice-log-bot\n  template:\n    metadata:\n      labels:\n        app: discord-voice-log-bot\n    spec:\n      containers:\n      - name: discord-voice-log-bot\n        image: quay.io/satackey/discord-voice-log-bot:latest\n        volumeMounts:\n        - name: bot-config\n          mountPath: /app/configs\n          readOnly: true\n      volumes:\n      - name: bot-config\n        secret:\n          secretName: discord-voice-log-bot-secret\n          items:\n          - key: config\n            path: config.ini\n",
    "policy_id": "unset-cpu-requirements",
    "violation_text": "container \"discord-voice-log-bot\" has cpu request 0"
  },
  {
    "id": "04873",
    "manifest_path": "data/manifests/the_stack_sample/sample_2209.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: discord-voice-log-bot-deployment\n  labels:\n    app: discord-voice-log-bot\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: discord-voice-log-bot\n  template:\n    metadata:\n      labels:\n        app: discord-voice-log-bot\n    spec:\n      containers:\n      - name: discord-voice-log-bot\n        image: quay.io/satackey/discord-voice-log-bot:latest\n        volumeMounts:\n        - name: bot-config\n          mountPath: /app/configs\n          readOnly: true\n      volumes:\n      - name: bot-config\n        secret:\n          secretName: discord-voice-log-bot-secret\n          items:\n          - key: config\n            path: config.ini\n",
    "policy_id": "unset-memory-requirements",
    "violation_text": "container \"discord-voice-log-bot\" has memory limit 0"
  },
  {
    "id": "04874",
    "manifest_path": "data/manifests/the_stack_sample/sample_2213.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: controller-manager\n  namespace: system\n  labels:\n    control-plane: controller-manager\nspec:\n  selector:\n    matchLabels:\n      control-plane: controller-manager\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        control-plane: controller-manager\n    spec:\n      containers:\n      - command:\n        - /manager\n        args:\n        - --leader-elect\n        - --metrics-bind-addr=127.0.0.1:8080\n        - --feature-gates=MachinePool=false\n        image: controller:latest\n        name: manager\n        env:\n        - name: NO_PROXY\n          value: 127.0.0.1,localhost\n        ports:\n        - containerPort: 9440\n          name: healthz\n          protocol: TCP\n        readinessProbe:\n          httpGet:\n            path: /readyz\n            port: healthz\n        livenessProbe:\n          httpGet:\n            path: /healthz\n            port: healthz\n        volumeMounts:\n        - mountPath: /var/run/docker.sock\n          name: dockersock\n        securityContext:\n          privileged: true\n      serviceAccountName: manager\n      volumes:\n      - name: dockersock\n        hostPath:\n          path: /var/run/docker.sock\n",
    "policy_id": "latest-tag",
    "violation_text": "The container \"manager\" is using an invalid container image, \"controller:latest\". Please use images that are not blocked by the `BlockList` criteria : [\".*:(latest)$\" \"^[^:]*$\" \"(.*/[^:]+)$\"]"
  },
  {
    "id": "04875",
    "manifest_path": "data/manifests/the_stack_sample/sample_2213.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: controller-manager\n  namespace: system\n  labels:\n    control-plane: controller-manager\nspec:\n  selector:\n    matchLabels:\n      control-plane: controller-manager\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        control-plane: controller-manager\n    spec:\n      containers:\n      - command:\n        - /manager\n        args:\n        - --leader-elect\n        - --metrics-bind-addr=127.0.0.1:8080\n        - --feature-gates=MachinePool=false\n        image: controller:latest\n        name: manager\n        env:\n        - name: NO_PROXY\n          value: 127.0.0.1,localhost\n        ports:\n        - containerPort: 9440\n          name: healthz\n          protocol: TCP\n        readinessProbe:\n          httpGet:\n            path: /readyz\n            port: healthz\n        livenessProbe:\n          httpGet:\n            path: /healthz\n            port: healthz\n        volumeMounts:\n        - mountPath: /var/run/docker.sock\n          name: dockersock\n        securityContext:\n          privileged: true\n      serviceAccountName: manager\n      volumes:\n      - name: dockersock\n        hostPath:\n          path: /var/run/docker.sock\n",
    "policy_id": "no-read-only-root-fs",
    "violation_text": "container \"manager\" does not have a read-only root file system"
  },
  {
    "id": "04876",
    "manifest_path": "data/manifests/the_stack_sample/sample_2213.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: controller-manager\n  namespace: system\n  labels:\n    control-plane: controller-manager\nspec:\n  selector:\n    matchLabels:\n      control-plane: controller-manager\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        control-plane: controller-manager\n    spec:\n      containers:\n      - command:\n        - /manager\n        args:\n        - --leader-elect\n        - --metrics-bind-addr=127.0.0.1:8080\n        - --feature-gates=MachinePool=false\n        image: controller:latest\n        name: manager\n        env:\n        - name: NO_PROXY\n          value: 127.0.0.1,localhost\n        ports:\n        - containerPort: 9440\n          name: healthz\n          protocol: TCP\n        readinessProbe:\n          httpGet:\n            path: /readyz\n            port: healthz\n        livenessProbe:\n          httpGet:\n            path: /healthz\n            port: healthz\n        volumeMounts:\n        - mountPath: /var/run/docker.sock\n          name: dockersock\n        securityContext:\n          privileged: true\n      serviceAccountName: manager\n      volumes:\n      - name: dockersock\n        hostPath:\n          path: /var/run/docker.sock\n",
    "policy_id": "privilege-escalation-container",
    "violation_text": "container \"manager\" is Privileged hence allows privilege escalation."
  },
  {
    "id": "04877",
    "manifest_path": "data/manifests/the_stack_sample/sample_2213.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: controller-manager\n  namespace: system\n  labels:\n    control-plane: controller-manager\nspec:\n  selector:\n    matchLabels:\n      control-plane: controller-manager\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        control-plane: controller-manager\n    spec:\n      containers:\n      - command:\n        - /manager\n        args:\n        - --leader-elect\n        - --metrics-bind-addr=127.0.0.1:8080\n        - --feature-gates=MachinePool=false\n        image: controller:latest\n        name: manager\n        env:\n        - name: NO_PROXY\n          value: 127.0.0.1,localhost\n        ports:\n        - containerPort: 9440\n          name: healthz\n          protocol: TCP\n        readinessProbe:\n          httpGet:\n            path: /readyz\n            port: healthz\n        livenessProbe:\n          httpGet:\n            path: /healthz\n            port: healthz\n        volumeMounts:\n        - mountPath: /var/run/docker.sock\n          name: dockersock\n        securityContext:\n          privileged: true\n      serviceAccountName: manager\n      volumes:\n      - name: dockersock\n        hostPath:\n          path: /var/run/docker.sock\n",
    "policy_id": "privileged-container",
    "violation_text": "container \"manager\" is privileged"
  },
  {
    "id": "04878",
    "manifest_path": "data/manifests/the_stack_sample/sample_2213.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: controller-manager\n  namespace: system\n  labels:\n    control-plane: controller-manager\nspec:\n  selector:\n    matchLabels:\n      control-plane: controller-manager\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        control-plane: controller-manager\n    spec:\n      containers:\n      - command:\n        - /manager\n        args:\n        - --leader-elect\n        - --metrics-bind-addr=127.0.0.1:8080\n        - --feature-gates=MachinePool=false\n        image: controller:latest\n        name: manager\n        env:\n        - name: NO_PROXY\n          value: 127.0.0.1,localhost\n        ports:\n        - containerPort: 9440\n          name: healthz\n          protocol: TCP\n        readinessProbe:\n          httpGet:\n            path: /readyz\n            port: healthz\n        livenessProbe:\n          httpGet:\n            path: /healthz\n            port: healthz\n        volumeMounts:\n        - mountPath: /var/run/docker.sock\n          name: dockersock\n        securityContext:\n          privileged: true\n      serviceAccountName: manager\n      volumes:\n      - name: dockersock\n        hostPath:\n          path: /var/run/docker.sock\n",
    "policy_id": "run-as-non-root",
    "violation_text": "container \"manager\" is not set to runAsNonRoot"
  },
  {
    "id": "04879",
    "manifest_path": "data/manifests/the_stack_sample/sample_2213.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: controller-manager\n  namespace: system\n  labels:\n    control-plane: controller-manager\nspec:\n  selector:\n    matchLabels:\n      control-plane: controller-manager\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        control-plane: controller-manager\n    spec:\n      containers:\n      - command:\n        - /manager\n        args:\n        - --leader-elect\n        - --metrics-bind-addr=127.0.0.1:8080\n        - --feature-gates=MachinePool=false\n        image: controller:latest\n        name: manager\n        env:\n        - name: NO_PROXY\n          value: 127.0.0.1,localhost\n        ports:\n        - containerPort: 9440\n          name: healthz\n          protocol: TCP\n        readinessProbe:\n          httpGet:\n            path: /readyz\n            port: healthz\n        livenessProbe:\n          httpGet:\n            path: /healthz\n            port: healthz\n        volumeMounts:\n        - mountPath: /var/run/docker.sock\n          name: dockersock\n        securityContext:\n          privileged: true\n      serviceAccountName: manager\n      volumes:\n      - name: dockersock\n        hostPath:\n          path: /var/run/docker.sock\n",
    "policy_id": "unset-cpu-requirements",
    "violation_text": "container \"manager\" has cpu request 0"
  },
  {
    "id": "04880",
    "manifest_path": "data/manifests/the_stack_sample/sample_2213.yaml",
    "manifest_yaml": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: controller-manager\n  namespace: system\n  labels:\n    control-plane: controller-manager\nspec:\n  selector:\n    matchLabels:\n      control-plane: controller-manager\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        control-plane: controller-manager\n    spec:\n      containers:\n      - command:\n        - /manager\n        args:\n        - --leader-elect\n        - --metrics-bind-addr=127.0.0.1:8080\n        - --feature-gates=MachinePool=false\n        image: controller:latest\n        name: manager\n        env:\n        - name: NO_PROXY\n          value: 127.0.0.1,localhost\n        ports:\n        - containerPort: 9440\n          name: healthz\n          protocol: TCP\n        readinessProbe:\n          httpGet:\n            path: /readyz\n            port: healthz\n        livenessProbe:\n          httpGet:\n            path: /healthz\n            port: healthz\n        volumeMounts:\n        - mountPath: /var/run/docker.sock\n          name: dockersock\n        securityContext:\n          privileged: true\n      serviceAccountName: manager\n      volumes:\n      - name: dockersock\n        hostPath:\n          path: /var/run/docker.sock\n",
    "policy_id": "unset-memory-requirements",
    "violation_text": "container \"manager\" has memory limit 0"
  }
]