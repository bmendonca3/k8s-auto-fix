apiVersion: v1
kind: Pod
metadata:
  name: release-name-pgadmin4-test-connection
  namespace: default
  labels:
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/name: pgadmin4
    app.kubernetes.io/version: '9.8'
    helm.sh/chart: pgadmin4-1.50.0
  annotations:
    helm.sh/hook: test
    helm.sh/hook-delete-policy: hook-succeeded
spec:
  securityContext:
    runAsNonRoot: true
    fsGroup: 5051
    runAsGroup: 5051
    runAsUser: 5051
  containers:
  - name: wget
    image: docker.io/busybox:latest
    env:
    - name: PGADMIN_HOST
      value: release-name-pgadmin4
    - name: PGADMIN_PORT
      value: '80'
    command:
    - /bin/sh
    - -ec
    - 'response=$(wget -qSO - http://${PGADMIN_HOST}:${PGADMIN_PORT} 2>&1)

      check=$(echo $response | grep -c ''200 OK''); echo $check; if [[ $check -gt
      0 ]]; then echo "Response OK"; else exit 1; fi

      '
    resources: {}
    securityContext:
      readOnlyRootFilesystem: true
  restartPolicy: Never
