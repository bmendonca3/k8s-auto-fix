apiVersion: batch/v1
kind: Job
metadata:
  name: release-name-kyverno-migrate-resources
  namespace: default
  labels:
    app.kubernetes.io/component: hooks
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/part-of: release-name-kyverno
    app.kubernetes.io/version: 3.5.2
    helm.sh/chart: kyverno-3.5.2
  annotations:
    helm.sh/hook: post-upgrade
    helm.sh/hook-delete-policy: before-hook-creation,hook-succeeded,hook-failed
    helm.sh/hook-weight: '200'
spec:
  backoffLimit: 2
  template:
    spec:
      serviceAccountName: release-name-kyverno-migrate-resources
      automountServiceAccountToken: true
      restartPolicy: Never
      containers:
      - name: kubectl
        image: reg.kyverno.io/kyverno/kyverno-cli:v1.15.2
        imagePullPolicy: IfNotPresent
        args:
        - migrate
        - --resource
        - cleanuppolicies.kyverno.io
        - --resource
        - clustercleanuppolicies.kyverno.io
        - --resource
        - clusterpolicies.kyverno.io
        - --resource
        - globalcontextentries.kyverno.io
        - --resource
        - policies.kyverno.io
        - --resource
        - policyexceptions.kyverno.io
        - --resource
        - updaterequests.kyverno.io
        resources:
          limits:
            cpu: 100m
            memory: 256Mi
          requests:
            cpu: 10m
            memory: 64Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          privileged: false
          readOnlyRootFilesystem: true
          runAsGroup: 65534
          runAsNonRoot: true
          runAsUser: 65534
          seccompProfile:
            type: RuntimeDefault
