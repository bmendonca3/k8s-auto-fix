apiVersion: v1
kind: Pod
metadata:
  name: release-name-vault-server-test
  namespace: default
  annotations:
    helm.sh/hook: test
spec:
  containers:
  - name: release-name-server-test
    image: hashicorp/vault:1.20.4
    imagePullPolicy: IfNotPresent
    env:
    - name: VAULT_ADDR
      value: http://release-name-vault.default.svc:8200
    command:
    - /bin/sh
    - -c
    - "echo \"Checking for sealed info in 'vault status' output\"\nATTEMPTS=10\nn=0\n\
      until [ \"$n\" -ge $ATTEMPTS ]\ndo\n  echo \"Attempt\" $n...\n  vault status\
      \ -format yaml | grep -E '^sealed: (true|false)' && break\n  n=$((n+1))\n  sleep\
      \ 5\ndone\nif [ $n -ge $ATTEMPTS ]; then\n  echo \"timed out looking for sealed\
      \ info in 'vault status' output\"\n  exit 1\nfi\n\nexit 0\n"
  restartPolicy: Never
