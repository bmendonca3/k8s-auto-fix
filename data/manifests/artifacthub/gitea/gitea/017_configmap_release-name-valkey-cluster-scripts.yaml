apiVersion: v1
kind: ConfigMap
metadata:
  name: release-name-valkey-cluster-scripts
  namespace: default
  labels:
    app.kubernetes.io/instance: release-name
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: valkey-cluster
    app.kubernetes.io/version: 8.1.3
    helm.sh/chart: valkey-cluster-3.0.24
data:
  ping_readiness_local.sh: "#!/bin/sh\nset -e\n\nVALKEY_STATUS_FILE=/tmp/.valkey_cluster_check\n\
    if [ ! -z \"$VALKEY_PASSWORD\" ]; then export REDISCLI_AUTH=$VALKEY_PASSWORD;\
    \ fi;\nresponse=$(\n  timeout -s 15 $1 \\\n  valkey-cli \\\n    -h localhost \\\
    \n    -p $VALKEY_PORT_NUMBER \\\n    ping\n)\nif [ \"$?\" -eq \"124\" ]; then\n\
    \  echo \"Timed out\"\n  exit 1\nfi\nif [ \"$response\" != \"PONG\" ]; then\n\
    \  echo \"$response\"\n  exit 1\nfi\nif [ ! -f \"$VALKEY_STATUS_FILE\" ]; then\n\
    \  response=$(\n    timeout -s 15 $1 \\\n    valkey-cli \\\n      -h localhost\
    \ \\\n      -p $VALKEY_PORT_NUMBER \\\n      CLUSTER INFO | grep cluster_state\
    \ | tr -d '[:space:]'\n  )\n  if [ \"$?\" -eq \"124\" ]; then\n    echo \"Timed\
    \ out\"\n    exit 1\n  fi\n  if [ \"$response\" != \"cluster_state:ok\" ]; then\n\
    \    echo \"$response\"\n    exit 1\n  else\n    touch \"$VALKEY_STATUS_FILE\"\
    \n  fi\nfi"
  ping_liveness_local.sh: "#!/bin/sh\nset -e\nif [ ! -z \"$VALKEY_PASSWORD\" ]; then\
    \ export REDISCLI_AUTH=$VALKEY_PASSWORD; fi;\nresponse=$(\n  timeout -s 15 $1\
    \ \\\n  valkey-cli \\\n    -h localhost \\\n    -p $VALKEY_PORT_NUMBER \\\n  \
    \  ping\n)\nif [ \"$?\" -eq \"124\" ]; then\n  echo \"Timed out\"\n  exit 1\n\
    fi\nresponseFirstWord=$(echo $response | head -n1 | awk '{print $1;}')\nif [ \"\
    $response\" != \"PONG\" ] && [ \"$responseFirstWord\" != \"LOADING\" ] && [ \"\
    $responseFirstWord\" != \"MASTERDOWN\" ]; then\n  echo \"$response\"\n  exit 1\n\
    fi"
