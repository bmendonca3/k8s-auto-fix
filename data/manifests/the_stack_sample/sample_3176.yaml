apiVersion: v1
kind: ConfigMap
metadata:
  name: harbor-nginx-config
data:
  conf: "worker_processes auto;\n\nevents {\n  worker_connections 1024;\n  use epoll;\n\
    \  multi_accept on;\n}\n\nhttp {\n  tcp_nodelay on;\n\n  # this is necessary for\
    \ us to be able to disable request buffering in all cases\n  proxy_http_version\
    \ 1.1;\n\n  upstream registry {\n    server registry:5000;\n  }\n\n  upstream\
    \ ui {\n    server ui:80;\n  }\n\n  server {\n    listen 80;\n    server_name\
    \ nginx \n\n    # disable any limits to avoid HTTP 413 for large image uploads\n\
    \    client_max_body_size 0;\n\n    # required to avoid HTTP 411: see Issue #1486\
    \ (https://github.com/docker/docker/issues/1486)\n    chunked_transfer_encoding\
    \ on;\n\n    location / {\n      proxy_pass http://ui/;\n      proxy_set_header\
    \ Host $http_host;\n      proxy_set_header X-Real-IP $remote_addr;\n      proxy_set_header\
    \ X-Forwarded-For $proxy_add_x_forwarded_for;\n\n      # When setting up Harbor\
    \ behind other proxy, such as an Nginx instance, remove the below line if the\
    \ proxy already has similar settings.\n      proxy_set_header X-Forwarded-Proto\
    \ $scheme;\n    \n      proxy_buffering off;\n      proxy_request_buffering off;\n\
    \    }\n\n    location /v1/ {\n      return 404;\n    }\n\n    location /v2/ {\n\
    \      proxy_pass http://registry/v2/;\n      proxy_set_header Host $http_host;\n\
    \      proxy_set_header X-Real-IP $remote_addr;\n      proxy_set_header X-Forwarded-For\
    \ $proxy_add_x_forwarded_for;\n\n      # When setting up Harbor behind other proxy,\
    \ such as an Nginx instance, remove the below line if the proxy already has similar\
    \ settings.\n      proxy_set_header X-Forwarded-Proto $scheme;\n\n      proxy_buffering\
    \ off;\n      proxy_request_buffering off;\n    }\n\n    location /service/ {\n\
    \      proxy_pass http://ui/service/;\n      proxy_set_header Host $http_host;\n\
    \      proxy_set_header X-Real-IP $remote_addr;\n      proxy_set_header X-Forwarded-For\
    \ $proxy_add_x_forwarded_for;\n    \n      # When setting up Harbor behind other\
    \ proxy, such as an Nginx instance, remove the below line if the proxy already\
    \ has similar settings.\n      proxy_set_header X-Forwarded-Proto $scheme;\n \
    \   \n      proxy_buffering off;\n      proxy_request_buffering off;\n    }\n\
    \  }\n}"
