apiVersion: batch/v1
kind: Job
metadata:
  generateName: litmus-wordpress-deployment-
  namespace: litmus
spec:
  template:
    metadata:
      name: litmus
      labels:
        app: wordpress-litmus
    spec:
      serviceAccountName: litmus
      restartPolicy: Never
      containers:
      - name: ansibletest
        image: openebs/ansible-runner:ci
        imagePullPolicy: Always
        env:
        - name: ANSIBLE_STDOUT_CALLBACK
          value: default
        - name: PROVIDER_STORAGE_CLASS
          value: openebs-cstor-disk
        - name: STORAGE_CLASS
          value: openebs-nfs
        - name: MYSQL_APP_PVC
          value: openebs-mysql
        - name: MYSQL_PASS
          value: w0rdpres5
        - name: WORDPRESS_APP_PVC
          value: openebs-wordpress
        - name: APP_LABEL
          value: app=wordpress
        - name: AFFINITY_LABEL
          value: openebs.io/target-affinity
        - name: APP_NAMESPACE
          value: app-wordpress-ns
        - name: APP_REPLICA
          value: replicas=1
        - name: ACTION
          value: provision
        - name: MYSQL_PV_CAPACITY
          value: 5G
        - name: WORDPRESS_PV_CAPACITY
          value: 5G
        - name: PVC_ACCESS_MODE
          value: ReadWriteMany
        command:
        - /bin/bash
        args:
        - -c
        - ansible-playbook ./apps/wordpress/deployers/test.yml -i /etc/ansible/hosts
          -v; exit 0
