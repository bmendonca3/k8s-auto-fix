apiVersion: v1
kind: ConfigMap
metadata:
  name: apparmor-profiles
  namespace: apparmor
data:
  k8s-nginx: "#include <tunables/global>\n\n# From https://github.com/jfrazelle/bane/blob/master/docker-nginx-sample\n\
    profile k8s-nginx flags=(attach_disconnected,mediate_deleted) {\n  #include <abstractions/base>\n\
    \n  network inet tcp,\n  network inet udp,\n  network inet icmp,\n\n  deny network\
    \ raw,\n\n  deny network packet,\n\n  file,\n  umount,\n\n  deny /bin/** wl,\n\
    \  deny /boot/** wl,\n  deny /dev/** wl,\n  deny /etc/** wl,\n  deny /home/**\
    \ wl,\n  deny /lib/** wl,\n  deny /lib64/** wl,\n  deny /media/** wl,\n  deny\
    \ /mnt/** wl,\n  deny /opt/** wl,\n  deny /proc/** wl,\n  deny /root/** wl,\n\
    \  deny /sbin/** wl,\n  deny /srv/** wl,\n  deny /tmp/** wl,\n  deny /sys/** wl,\n\
    \  deny /usr/** wl,\n\n  audit /** w,\n\n  /var/run/nginx.pid w,\n\n  /usr/sbin/nginx\
    \ ix,\n\n  deny /bin/dash mrwklx,\n  deny /bin/sh mrwklx,\n  deny /usr/bin/top\
    \ mrwklx,\n\n  capability chown,\n  capability dac_override,\n  capability setuid,\n\
    \  capability setgid,\n  capability net_bind_service,\n\n  deny @{PROC}/{*,**^[0-9*],sys/kernel/shm*}\
    \ wkx,\n  deny @{PROC}/sysrq-trigger rwklx,\n  deny @{PROC}/mem rwklx,\n  deny\
    \ @{PROC}/kmem rwklx,\n  deny @{PROC}/kcore rwklx,\n  deny mount,\n  deny /sys/[^f]*/**\
    \ wklx,\n  deny /sys/f[^s]*/** wklx,\n  deny /sys/fs/[^c]*/** wklx,\n  deny /sys/fs/c[^g]*/**\
    \ wklx,\n  deny /sys/fs/cg[^r]*/** wklx,\n  deny /sys/firmware/efi/efivars/**\
    \ rwklx,\n  deny /sys/kernel/security/** rwklx,\n}"
